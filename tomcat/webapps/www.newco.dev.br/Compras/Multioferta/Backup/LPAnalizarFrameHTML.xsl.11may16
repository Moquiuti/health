<?xml version="1.0" encoding="iso-8859-1"?>
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0">
<xsl:import href = "http://www.newco.dev.br/General/General.xsl"/>
<xsl:output media-type="text/html" method="html" encoding="iso-8859-1"/>
<xsl:param name="lang" select="@lang"/>

<xsl:template match="/">
<xsl:choose>
<xsl:when test="//xsql-error">
	<xsl:apply-templates select="//xsql-error"/>
</xsl:when>
<xsl:otherwise>

<html>
<head>
	<!--idioma-->
	<xsl:variable name="lang">
		<xsl:choose>
		<xsl:when test="/Analizar/LANG"><xsl:value-of select="/Analizar/LANG"/></xsl:when>
		<xsl:otherwise>spanish</xsl:otherwise>
		</xsl:choose>
	</xsl:variable>
	<xsl:variable name="doc">http://www.newco.dev.br/General/texts_<xsl:value-of select="$lang"/>.xml</xsl:variable>
	<!--idioma fin-->
        <link href="http://www.newco.dev.br/General/Tabla-popup.css" rel="stylesheet" type="text/css"/>
	<!--style-->
	<xsl:call-template name="estiloIndip"/>
	<!--fin de style-->

	<link rel="stylesheet" href="http://www.newco.dev.br/General/calendario/spiffyCal_v2_1.css" type="text/css"/>

	<script type="text/javascript" src="http://www.newco.dev.br/General/jquery-1.8.3.min.js"></script>
	<script type="text/javascript" src="http://www.newco.dev.br/General/jquery.highlight-5.closure.js"></script>
	<script type="text/javascript" src="http://www.newco.dev.br/General/basic_180608.js"></script>
	<script type="text/javascript" src="http://www.newco.dev.br/General/divisas.js"></script>
	<script type="text/javascript" src="http://www.newco.dev.br/General/calendario/spiffyCal_v2_1.js"></script>
	<script type="text/javascript" src="http://www.newco.dev.br/Compras/Multioferta/LPAnalizar.111115.js"></script>
        <script type="text/javascript" src="http://www.newco.dev.br/General/Tabla-popup.js"></script>

        <script type="text/javascript">
		var nombre	= '<xsl:value-of select="document($doc)/translation/texts/item[@name='nombre']/node()"/>';
                var proveedor	= '<xsl:value-of select="document($doc)/translation/texts/item[@name='proveedor']/node()"/>';
                var ref_estandar	= '<xsl:value-of select="document($doc)/translation/texts/item[@name='ref_estandar']/node()"/>';
                var ref_proveedor	= '<xsl:value-of select="document($doc)/translation/texts/item[@name='ref_proveedor']/node()"/>';
                var marca	= '<xsl:value-of select="document($doc)/translation/texts/item[@name='marca']/node()"/>';
                var iva	= '<xsl:value-of select="document($doc)/translation/texts/item[@name='iva']/node()"/>';
                var unidad_basica	= '<xsl:value-of select="document($doc)/translation/texts/item[@name='unidad_basica']/node()"/>';
                var unidad_lote	= '<xsl:value-of select="document($doc)/translation/texts/item[@name='unidad_lote']/node()"/>';
                var farmacia	= '<xsl:value-of select="document($doc)/translation/texts/item[@name='farmacia']/node()"/>';
                var homologado	= '<xsl:value-of select="document($doc)/translation/texts/item[@name='homologado']/node()"/>';
                var precio	= '<xsl:value-of select="document($doc)/translation/texts/item[@name='precio']/node()"/>';
                var catalogo	= '<xsl:value-of select="document($doc)/translation/texts/item[@name='catalogo']/node()"/>';
                var familia	= '<xsl:value-of select="document($doc)/translation/texts/item[@name='familia']/node()"/>';
                var subfamilia	= '<xsl:value-of select="document($doc)/translation/texts/item[@name='subfamilia']/node()"/>';
                var grupo	= '<xsl:value-of select="document($doc)/translation/texts/item[@name='grupo']/node()"/>';
	</script>
<xsl:text disable-output-escaping="yes"><![CDATA[

	<script type="text/javascript">
	<!--
		var msgCantidadNegativa='';

		// Variables globales que indican que tipo de plantilla utilizar
		var nuevoModeloNegocio='';
		var pedidoAntiguo='';

		// Otras variables globales
		var IDCentro;
		var IDPlantilla;
		var IDPais;
		var IDIdioma;
		var mostrarPrecioIVA;
		var usarGrupo;
		var plazoEntrega;
		var tipoPlantilla;
		var ocultarPrecioReferencia;
		var sinMarca;
                var minimalista;

		// Variables globales para clubs privados de compra (limites de compra mensuales)
		var limiteComprasMensual, fechaCuota, comprasPrevias;


]]></xsl:text>
		IDCentro		= '<xsl:value-of select="/Analizar/ANALISIS/CABECERA/LISTA/CENTRO/CEN_ID"/>';
		IDPlantilla		= '<xsl:value-of select="/Analizar/PL_ID"/>';
		IDPais			= '<xsl:value-of select="/Analizar/ANALISIS/IDPAIS"/>';
		IDIdioma		= '<xsl:value-of select="/Analizar/ANALISIS/IDIDIOMA"/>';
		mostrarPrecioIVA	= '<xsl:choose><xsl:when test="/Analizar/ANALISIS/MOSTRAR_PRECIO_CON_IVA">S</xsl:when><xsl:otherwise>N</xsl:otherwise></xsl:choose>';
		usarRefProveedor	= '<xsl:choose><xsl:when test="/Analizar/ANALISIS/UTILIZAR_REFERENCIA_PROVEEDOR">S</xsl:when><xsl:otherwise>N</xsl:otherwise></xsl:choose>';
		usarGrupo		= '<xsl:choose><xsl:when test="/Analizar/ANALISIS/UTILIZAR_GRUPO">S</xsl:when><xsl:otherwise>N</xsl:otherwise></xsl:choose>';

		plazoEntrega		= '<xsl:value-of select="/Analizar/ANALISIS/CABECERA/LISTA/LP_PLAZOENTREGA"/>';
		ocultarPrecioReferencia	= '<xsl:value-of select="/Analizar/ANALISIS/OCULTAR_PRECIO_REFERENCIA/@Ocultar"/>';
		sinMarca		= '<xsl:choose><xsl:when test="/Analizar/ANALISIS/SIN_MARCA">S</xsl:when><xsl:otherwise>N</xsl:otherwise></xsl:choose>';

		limiteComprasMensual	= '<xsl:choose><xsl:when test="/Analizar/ANALISIS/LIMITECOMPRAS"><xsl:value-of select="/Analizar/ANALISIS/LIMITECOMPRAS"/></xsl:when><xsl:otherwise>N</xsl:otherwise></xsl:choose>';
		if(limiteComprasMensual != 'N'){
			fechaCuota	= '<xsl:value-of select="/Analizar/ANALISIS/FECHACUOTA"/>';
			comprasPrevias	= '<xsl:choose><xsl:when test="/Analizar/ANALISIS/COMPRASPREVIAS != ''"><xsl:value-of select="/Analizar/ANALISIS/COMPRASPREVIAS"/></xsl:when><xsl:otherwise>0</xsl:otherwise></xsl:choose>';
		}
                        minimalista    =  '<xsl:choose><xsl:when test="/Analizar/ANALISIS/MINIMALISTA">S</xsl:when><xsl:otherwise>N</xsl:otherwise></xsl:choose>';


	<xsl:choose>
	<xsl:when test="/Analizar/ANALISIS/MOSTRAR_PRECIO_REFERENCIA/@NuevoModeloNegocio != ''">
		nuevoModeloNegocio = '<xsl:value-of select="/Analizar/ANALISIS/MOSTRAR_PRECIO_REFERENCIA/@NuevoModeloNegocio"/>';
	</xsl:when>
	<xsl:when test="/Analizar/ANALISIS/OCULTAR_PRECIO_REFERENCIA/@NuevoModeloNegocio != ''">
		nuevoModeloNegocio = '<xsl:value-of select="/Analizar/ANALISIS/OCULTAR_PRECIO_REFERENCIA/@NuevoModeloNegocio"/>';
	</xsl:when>
	</xsl:choose>

	<xsl:choose>
	<xsl:when test="/Analizar/ANALISIS/MOSTRAR_PRECIO_REFERENCIA/@PedidoAntiguo != ''">
		pedidoAntiguo = '<xsl:value-of select="/Analizar/ANALISIS/MOSTRAR_PRECIO_REFERENCIA/@PedidoAntiguo"/>';
	</xsl:when>
	<xsl:when test="/Analizar/ANALISIS/OCULTAR_PRECIO_REFERENCIA/@PedidoAntiguo != ''">
		pedidoAntiguo = '<xsl:value-of select="/Analizar/ANALISIS/OCULTAR_PRECIO_REFERENCIA/@PedidoAntiguo"/>';
	</xsl:when>
	</xsl:choose>
<xsl:text disable-output-escaping="yes"><![CDATA[

		var arrayProductosProveedoresLineas=new Array();
		var arrayProveedores=new Array();
		var arrayProveedoresConDiferenteSigno=new Array();
		var arrayCentros=new Array();
		var arrayLugaresEntrega=new Array();
		var arrayCentrosConsumo=new Array();
		var arrayLineasProductos=new Array();

]]></xsl:text>

		<!-- Strings para idiomas -->
		var str_SinGrupo		= '<xsl:value-of select="document($doc)/translation/texts/item[@name='sin_grupo']/node()"/>';
		var str_SinSubfamilia		= '<xsl:value-of select="document($doc)/translation/texts/item[@name='sin_subfamilia']/node()"/>';
		var str_PedirOferta		= '<xsl:value-of select="document($doc)/translation/texts/item[@name='pedir_oferta']/node()"/>';
		var str_Alternativa		= '<xsl:value-of select="document($doc)/translation/texts/item[@name='alternativa']/node()"/>';
		var str_Ref			= '<xsl:value-of select="document($doc)/translation/texts/item[@name='Ref']/node()"/>';
		var str_Prod			= '<xsl:value-of select="document($doc)/translation/texts/item[@name='Prod']/node()"/>';
		var str_NoSePuedeEnviarPedido	= '<xsl:value-of select="document($doc)/translation/texts/item[@name='no_se_puede_enviar_pedido']/node()"/>';
		var str_FechaLimiteRespuesta	= '<xsl:value-of select="document($doc)/translation/texts/item[@name='fecha_limite_respuesta']/node()"/>';
		var str_LimiteComprasSuperado	= '<xsl:value-of select="document($doc)/translation/texts/item[@name='limite_compras_mensual_superado']/node()"/>';
		var str_FechaCuotaCaducada	= '<xsl:value-of select="document($doc)/translation/texts/item[@name='fecha_cuota_activa_caducada']/node()"/>';

<xsl:for-each select="/Analizar/ANALISIS/LINEAS/LINEA_ROW">
		var lineas			= [];
		lineas['LLP_ID']		= '<xsl:value-of select="LLP_ID"/>';
		lineas['DescripcionLinea']	= '<xsl:value-of select="LLP_DESCRIPCION_LINEA"/>';
		lineas['ContieneFiltroTXT']	= 'S';
		lineas['ContieneSeleccion']	= 'S';
		lineas['Mostrar']		= 'S';

		<xsl:if test="PRODUCTOS/PRODUCTOS_ROW">
		lineas['Productos']	= new Array();
		<xsl:for-each select="PRODUCTOS/PRODUCTOS_ROW">
			var producto		= [];
			producto['PLL_ID']		= '<xsl:value-of select="PLL_ID"/>';
			producto['PedidoMinimo']	= '<xsl:value-of select="PEDIDO_MINIMO"/>';
			producto['Nombre']		= '<xsl:value-of select="NOMBRE"/>';
			producto['IDProducto']		= '<xsl:value-of select="PRO_ID"/>';
			producto['Referencia']		= '<xsl:value-of select="PRO_REFERENCIA"/>';
			producto['RefPrivada']		= '<xsl:value-of select="REFERENCIAPRIVADA"/>';
			producto['RefCliente']		= '<xsl:value-of select="REFERENCIACLIENTE"/>';
			producto['Subfamilia']		= '<xsl:value-of select="SUBFAMILIA"/>';
			producto['Grupo']		= '<xsl:value-of select="GRUPO"/>';
			producto['NombrePrivado']	= '<xsl:value-of select="NOMBREPRIVADO"/>';
			producto['Marca']		= '<xsl:value-of select="MARCA"/>';
			producto['UdsXLote_SinFormato']	= '<xsl:value-of select="PRO_UNIDADESPORLOTE_SINFORMATO"/>';
			producto['UdsXLote']		= '<xsl:value-of select="PRO_UNIDADESPORLOTE"/>';
			producto['UdBasica']		= '<xsl:value-of select="PRO_UNIDADBASICA"/>';
			producto['Categoria']		= '<xsl:value-of select="PRO_CATEGORIA"/>';
			producto['TipoIVA']		= '<xsl:value-of select="PLL_TIPOIVA"/>';
			producto['CosteTransporte']	= '<xsl:value-of select="COSTE_TRANSPORTE"/>';
			producto['IDProveedor']		= '<xsl:value-of select="IDPROVEEDOR"/>';
			producto['Proveedor']		= '<xsl:value-of select="PROVEEDOR"/>';
			producto['IDCentroProv']	= '<xsl:value-of select="IDCENTROPROVEEDOR"/>';
			producto['CentroProv']		= '<xsl:value-of select="CENTROPROVEEDOR"/>';
			producto['Cantidad']		= '<xsl:value-of select="CANTIDAD"/>';
			producto['Cantidad_SinFormato']	= '<xsl:value-of select="CANTIDAD_SINFORMATO"/>';
			<!-- Precio proveedor -->
			producto['Tarifa_SinFormat']	= '<xsl:value-of select="TARIFA_SINFORMATO"/>';
			producto['Tarifa']		= '<xsl:value-of select="TARIFA"/>';
			<!-- Precio proveedor con IVA-->
			producto['TarifaIVA']		= '<xsl:value-of select="TARIFA_CONIVA"/>';
			producto['TarifaIVA_SinFormat']	= '<xsl:value-of select="TARIFA_CONIVA_SINFORMATO"/>';
			<!-- Precio historico -->
			producto['PrecioReferencia']	= '<xsl:value-of select="PRECIO_REFERENCIA"/>';

			producto['DivisaPrefijo']	= '<xsl:value-of select="DIV_PREFIJO"/>';
			producto['DivisaSufijo']	= '<xsl:value-of select="DIV_SUFIJO"/>';
			<!-- Importe del IVA -->
			producto['ImporteIVA']		= '<xsl:value-of select="IMPORTEIVA"/>';
			producto['ImporteIVA_SinFormat']= '<xsl:value-of select="IMPORTEIVA_SINFORMATO"/>';
			<!-- Comision MVM (siempre se incluye el IVA) -->
			producto['ComisionMVM']		= '<xsl:value-of select="COMISIONMVM_CONIVA"/>';
			producto['ComisionMVM_SinFormat']= '<xsl:value-of select="COMISIONMVM_CONIVA_SINFORMATO"/>';
                        producto['IDImage']= '<xsl:value-of select="IMAGENES/IMAGEN/@id"/>';
                        producto['Image']= '<xsl:value-of select="IMAGENES/IMAGEN/@peq"/>';

<!-- DC - 21may15 - Campos obsoletos a eliminar
			producto['TarifaTotal_SFormat']	= '<xsl:value-of select="TARIFA_TOTAL_SINFORMATO"/>';
			producto['TarifaTotal']		= '<xsl:value-of select="TARIFA_TOTAL"/>';
			producto['TarifaTotal_CIVA']	= '<xsl:value-of select="TARIFA_TOTAL_CONIVA"/>';
			producto['TarifaTotal_CIVA_SFormat']	= '<xsl:value-of select="TARIFA_TOTAL_CONIVA_SINFORMATO"/>';

			producto['Total']		= '<xsl:value-of select="TOTAL"/>';
			producto['TotalFormato']	= '<xsl:value-of select="TOTAL_FORMATO"/>';
			producto['SumaFinalFormato']	= '<xsl:value-of select="LINEASUMAFINAL_FORMATO"/>';
-->
			producto['VariacionPrecio']	= '<xsl:choose><xsl:when test="CARO">Caro</xsl:when><xsl:when test="BARATO">Barato</xsl:when></xsl:choose>';
			producto['VariacionPrecioFinal']= '<xsl:choose><xsl:when test="PRECIOFINAL_CARO">Caro</xsl:when><xsl:when test="PRECIOFINAL_BARATO">Barato</xsl:when></xsl:choose>';

			producto['stringBuscador']	= '<xsl:value-of select="PRO_REFERENCIA"/> <xsl:value-of select="REFERENCIAPRIVADA"/> <xsl:value-of select="REFERENCIACLIENTE"/> <xsl:value-of select="NOMBREPRIVADO"/> <xsl:value-of select="MARCA"/>';

			<!-- Variables para los filtros -->
			producto['Mostrar']		= 'S';
			producto['Seleccionado']	= 'N';

			<xsl:if test="TIPO_SIN_STOCK">
				producto['TipoSinStock']	= '<xsl:value-of select="TIPO_SIN_STOCK"/>';
				producto['TextSinStock']	= '<xsl:value-of select="TEXTO_SIN_STOCK"/>';
				producto['RefAlternativa']	= '<xsl:value-of select="REFERENCIAALTERNATIVA"/>';
				producto['DescAlternativa']	= '<xsl:value-of select="DESCRIPCIONALTERNATIVA"/>';
			</xsl:if>

			lineas['Productos'].push(producto);
		</xsl:for-each>
		</xsl:if>

		arrayLineasProductos.push(lineas);
</xsl:for-each>

<xsl:for-each select="Analizar/ANALISIS/CABECERA/TODOSLUGARESENTREGA/CENTRO">
		arrayCentros[arrayCentros.length]=new Array(<xsl:value-of select="@ID"/>,
				'<xsl:value-of select="@nombre"/>',
				'<xsl:value-of select="PEDIDO_MINIMO/IMPORTE"/>',
				'<xsl:value-of select="COSTE_TRANSPORTE/IMPORTE"/>'
		);

	<xsl:for-each select="LUGARESENTREGA/LUGARENTREGA">
		arrayLugaresEntrega[arrayLugaresEntrega.length]=new Array(<xsl:value-of select="ID"/>,
				<xsl:value-of select="IDCENTRO"/>,
				'<xsl:value-of select="REFERENCIA"/>',
				'<xsl:value-of select="NOMBRE"/>',
				'<xsl:value-of select="DIRECCION"/>',
				'<xsl:value-of select="CPOSTAL"/>',
				'<xsl:value-of select="POBLACION"/>',
				'<xsl:value-of select="PROVINCIA"/>',
				'<xsl:value-of select="PORDEFECTO"/>',
				'<xsl:value-of select="../../PEDIDO_MINIMO/IMPORTE"/>',
				'<xsl:value-of select="PORDEFECTO_FARMACIA"/>'
		);
	</xsl:for-each>
</xsl:for-each>

<xsl:for-each select="Analizar/ANALISIS/CABECERA/TODOSCENTROSCONSUMO/CENTRO">
	<xsl:for-each select="CENTROSCONSUMO/CENTROCONSUMO">
		arrayCentrosConsumo[arrayCentrosConsumo.length]=new Array(<xsl:value-of select="ID"/>,
				<xsl:value-of select="IDCENTRO"/>,
				'<xsl:value-of select="REFERENCIA"/>',
				'<xsl:value-of select="NOMBRE_CORTO"/>',
				'<xsl:value-of select="PORDEFECTO"/>'
		);
	</xsl:for-each>
</xsl:for-each>

<xsl:for-each select="//Analizar/ANALISIS/LINEAS/LINEA_ROW">
		arrayProductosProveedoresLineas[arrayProductosProveedoresLineas.length]='<xsl:value-of select="PRODUCTOS/PRODUCTOS_ROW/PROVEEDOR" disable-output-escaping="yes"/>';
</xsl:for-each>

<xsl:text disable-output-escaping="yes"><![CDATA[

		for(var n=0;n<arrayProductosProveedoresLineas.length;n++){
			var proveedor=arrayProductosProveedoresLineas[n];
			var existe=0;

			for(var i=0;i<arrayProveedores.length && existe==0;i++){
				if(arrayProveedores[i][0]==proveedor){
					existe=1;
				}
			}

			if(existe==0)
				arrayProveedores[arrayProveedores.length]=new Array(proveedor,'');
		}

		var suma=0;
		var vector;
		var const_decimales = 0;

		// Creamos un array de num_cols posiciones
		function crearArray(num_cols){
			max_cols=parseInt(num_cols);
			count=0;
			suma=0;
			vector = new Array(max_cols);
		}

		// Rellenamos el array con el identificador y el precio
		function anadirArray(identificador,precio){
			vector[count]= new Array(2);
			vector[count][0]=identificador;
			vector[count][1]=precio;
			count++;
		}


		/********* AQUI EMPIEZAN LAS FUNCIONES DEL FRAME DE ABAJO (FECHAS) ***************/
		//var signo='';

		function obtenerSignoDelProveedor(proveedor){
			for(var i=0;i<arrayProveedores.length;i++){
				//alert('obtener: '+arrayProveedores[i][0]+' '+arrayProveedores[i][1]);

				if(arrayProveedores[i][0]==proveedor){
					//alert('obtener: '+arrayProveedores[i][0]+' '+arrayProveedores[i][1]);
					return arrayProveedores[i][1];
				}
			}
		}

		function setSignoDelProveedor(proveedor, elSigno){
			for(var i=0;i<arrayProveedores.length;i++){
				if(arrayProveedores[i][0]==proveedor){
					//alert('set: '+arrayProveedores[i][0]+' '+elSigno);
					arrayProveedores[i][1]=elSigno;
				}
			}
		}

		function resetSignoDelProveedor(){
			for(var i=0;i<arrayProveedores.length;i++){
				arrayProveedores[i][1]='';
			}
		}

		function insertarSiNoExiste(proveedor){
			var existe=0;
			for(var i=0;i<arrayProveedoresConDiferenteSigno.length;i++){
				if(arrayProveedoresConDiferenteSigno[i]==proveedor){
					existe=1;
				}
			}

			if(!existe)
				arrayProveedoresConDiferenteSigno[arrayProveedoresConDiferenteSigno.length]=proveedor;

			return arrayProveedoresConDiferenteSigno;
		}

		function comprobarTodasCantidadesMismoSigno(){
			var form;
			var id;
			var signoLocal='';

			for(var i=0;i<document.forms.length;i++){
				form=document.forms[i];

				for(var j=0;j<form.length;j++){
					if(form.elements[j].name.substring(0,14)=='NuevaCantidad_' && form.elements['SELECCION'].checked==true){
						id=obtenerId(form.elements[j].name);
						signoLocal=obtenerSignoDelProveedor(form.elements['PRODUCTOPROVEEDOR_'+id].value);

						if(parseFloat(desformateaDivisa(form.elements[j].value))<0){
							if(signoLocal=='' || signoLocal=='-'){
								setSignoDelProveedor(form.elements['PRODUCTOPROVEEDOR_'+id].value,'-');
							}else{
								arrayProveedoresConDiferenteSigno=insertarSiNoExiste(form.elements['PRODUCTOPROVEEDOR_'+id].value);
							}
						}else{
							if(signoLocal=='' || signoLocal=='+'){
								setSignoDelProveedor(form.elements['PRODUCTOPROVEEDOR_'+id].value,'+');
							}else{
								arrayProveedoresConDiferenteSigno=insertarSiNoExiste(form.elements['PRODUCTOPROVEEDOR_'+id].value);
							}
						}
					}
				}
			}

			if(arrayProveedoresConDiferenteSigno.length==0)
				return true;
			else
				return arrayProveedoresConDiferenteSigno;
		}

		function algunProveedorConCantidadesNegativas(msgCantidadNegativa){
			msgCantidadNegativa='';
			var existe=0;

			for(var n=0;n<arrayProveedores.length;n++){
				if(arrayProveedores[n][1]=='-' && !existe){
					existe=1;
					msgCantidadNegativa+=document.forms['form_iddivisa'].elements['CANTIDADES_NEGATIVAS'].value;
					//arrayProveedores[n][0]
				}
			}

			return msgCantidadNegativa;
		}

		function asignarMensajeProveedoresDiferenteSigno(arrayProveedoresConDiferenteSigno){
			var msgDiferenteSigno='';

			if(arrayProveedoresConDiferenteSigno.length>0){
				for(var n=0;n<arrayProveedoresConDiferenteSigno.length;n++){
					msgDiferenteSigno+=document.forms['form_iddivisa'].elements['VERIFIQUE_CANTIDADES_ABONO'].value+' '+arrayProveedoresConDiferenteSigno[n]+' '+ document.forms['form_iddivisa'].elements['SON_TODAS_NEGATIVAS'].value+'.\n';
				}
			}

			return msgDiferenteSigno;
		}

		function obtenerValorMinimo(objDepl){
			var minimo;

			minimo=parseInt(objDepl.options[0].value);
			for(var n=1;n<objDepl.options.length;n++){
				if(parseInt(objDepl.options[n].value)<minimo){
					minimo=parseInt(objDepl.options[n].value);
				}
			}
			return minimo;
		}

		function calculaFechaCalendarios(mas){
			var hoy=new Date();
			var Resultado=calcularDiasHabiles(hoy,mas);
			var elDia=Resultado.getDate();
			var elMes=Number(Resultado.getMonth())+1;
			var elAnyo=Resultado.getFullYear();
			var laFecha=elDia+'/'+elMes+'/'+elAnyo;

			return laFecha;
		}

		function asignarValorDesplegable(form,nombreObj,valor){
			var indiceSeleccionado=form.elements[nombreObj].length-1;

			for(var n=0;n<form.elements[nombreObj].length;n++){
				if(form.elements[nombreObj].options[n].value==valor){
					indiceSeleccionado=n;
				}
			}

			form.elements[nombreObj].selectedIndex=indiceSeleccionado;
		}

		function actualizarPlazo(form,nombreObj, fFechaOrigen){
			var fechaOrigen=fFechaOrigen.getDate()+'/'+(Number(fFechaOrigen.getMonth())+1)+'/'+fFechaOrigen.getFullYear();
			var fechaDestino=form.elements['FECHA_'+nombreObj].value;
			var nombreCombo;

			if(CheckDate(fechaDestino)==''){
				var fFechaDestino=new Date(formatoFecha(fechaDestino,'E','I'));

				if(nombreObj=='ENTREGA'){
					var diferencia=diferenciaDias(fFechaOrigen,fFechaDestino,'HABILES');
					nombreCombo='COMBO_'+nombreObj;
				}else{
					var diferencia=diferenciaDias(fFechaOrigen,fFechaDestino,'NATURALES');
					nombreCombo='IDPLAZOPAGO';
				}

				asignarValorDesplegable(form,nombreCombo,diferencia);
			}else{
				alert(CheckDate(fechaDestino));
			}
		}
	//-->
	</script>
]]></xsl:text>

	<style type="text/css">
		.highlight{background-color:yellow;}
	</style>
</head>

<xsl:variable name="num_cols"><xsl:value-of select="count(//PRODUCTOS_ROW)"/></xsl:variable>

<body class="gris">
<xsl:choose><!-- error -->
<xsl:when test="//xsql-error">
	<xsl:apply-templates select="//xsql-error"/>
</xsl:when>
<xsl:when test="//SESION_CADUCADA">
	<xsl:apply-templates select="//SESION_CADUCADA"/>
</xsl:when>
<xsl:otherwise>
	<!--Avisamos de que hemos terminado la carga del frame.	heAcabado - tipo 1=Multioferta   tipo 0=Pedido directo-->
<!--
	<xsl:attribute name="onLoad">
		<xsl:if test="not(//CENTRALCOMPRAS) and not(//MULTICENTROS)">
			inicializarDesplegableCentrosConsumo(<xsl:value-of select="//Analizar/ANALISIS/CABECERA/LISTA/CENTRO/CEN_ID"/>);
		</xsl:if>
	</xsl:attribute>
-->
	<div id="spiffycalendar" class="text"></div>
	<script type="text/javascript">
		var calFechaEntrega = new ctlSpiffyCalendarBox("calFechaEntrega", "formBot", "FECHA_ENTREGA","btnDateFechaEntrega",calculaFechaCalendarios('<xsl:value-of select="/Analizar/ANALISIS/CABECERA/LISTA/LP_PLAZOENTREGA"/>'),scBTNMODE_CLASSIC,'ONCHANGE|actualizarPlazo(document.forms[\'formBot\'],\'ENTREGA\',new Date());#CHANGEDAY|actualizarPlazo(document.forms[\'formBot\'],\'ENTREGA\',new Date());');
	</script>

<!-- 29may15 - DC - La fecha de pago se calcula en el PL/SQL
	<script type="text/javascript">
		var calFechaPago = new ctlSpiffyCalendarBox("calFechaPago", "formBot", "FECHA_PAGO","btnDateFechaPago",calculaFechaCalendarios('<xsl:value-of select="/Analizar/ANALISIS/CABECERA/LISTA/PLAZOSPAGO/field/@current"/>'),scBTNMODE_CLASSIC,'ONCHANGE|actualizarPlazo(document.forms[\'formBot\'],\'PAGO\',new Date());#CHANGEDAY|actualizarPlazo(document.forms[\'formBot\'],\'PAGO\',new Date());');
	</script>
-->
	<!--Creamos un array con los productos y los precios-->
	<script type="text/javascript">
		crearArray('<xsl:value-of select="$num_cols"/>');
		<xsl:for-each select="Analizar/ANALISIS/LINEAS/LINEA_ROW/PRODUCTOS/PRODUCTOS_ROW">
			anadirArray('<xsl:value-of select="PLL_ID"/>','<xsl:value-of select="TOTAL"/>');
		</xsl:for-each>
	</script>

	<xsl:variable name="OcultarPrecioReferencia"><xsl:value-of select="/Analizar/ANALISIS/OCULTAR_PRECIO_REFERENCIA/@Ocultar"/></xsl:variable>

	<xsl:apply-templates select="Analizar/ANALISIS/CABECERA/LISTA"/>

	<!--idioma-->
	<xsl:variable name="lang">
		<xsl:choose>
		<xsl:when test="/Analizar/LANG"><xsl:value-of select="/Analizar/LANG"/></xsl:when>
		<xsl:otherwise>spanish</xsl:otherwise>
		</xsl:choose>
	</xsl:variable>
	<xsl:variable name="doc">http://www.newco.dev.br/General/texts_<xsl:value-of select="$lang"/>.xml</xsl:variable>
	<!--idioma fin-->

	<form name="form_iddivisa" target="mainFrame">
		<input type="hidden" name="OCULTARPRECIOREFERENCIA" value="{$OcultarPrecioReferencia}"/>
<!--		<input type="hidden" name="IDDIVISA" value="0"/>-->
		<input type="hidden" name="LP_PLAZOENTREGA" value="{/Analizar/ANALISIS/CABECERA/LISTA/LP_PLAZOENTREGA}"/>
		<input type="hidden" name="CATEGORIA" value="{/Analizar/ANALISIS/CATEGORIA}"/>
		<input type="hidden" name="IDLUGARENTREGAANTERIOR" value="{/Analizar/ANALISIS/CABECERA/LISTA/IDLUGARENTREGAANTERIOR}"/>

		<!--	20set10	Bloquear Muestras	-->
		<input type="hidden" name="BLOQUEARMUESTRAS" value="{/Analizar/ANALISIS/BLOQUEARMUESTRASCLIENTE}"/>

		<!--MENSAJE JS-->
		<input type="hidden" name="CANTIDAD_INCORRECTA" value="{document($doc)/translation/texts/item[@name='cantidad_incorrecta_sostituye']/node()}"/>
		<input type="hidden" name="MSG_ERROR" value="{document($doc)/translation/texts/item[@name='msg_error']/node()}"/>
		<input type="hidden" name="FECHA_MINIMA" value="{document($doc)/translation/texts/item[@name='fecha_minima']/node()}"/>
		<input type="hidden" name="SOLICITUD_MUESTRAS" value="{document($doc)/translation/texts/item[@name='solicitud_muestras_pedido']/node()}"/>
		<input type="hidden" name="NO_MUESTRAS" value="{document($doc)/translation/texts/item[@name='no_muestras']/node()}"/>
		<input type="hidden" name="LIMITE_MUESTRAS" value="{document($doc)/translation/texts/item[@name='limite_muestras']/node()}"/>
		<input type="hidden" name="CANTIDAD_NO_O" value="{document($doc)/translation/texts/item[@name='cantidad_no_0']/node()}"/>
		<input type="hidden" name="CANTIDADES_NEGATIVAS" value="{document($doc)/translation/texts/item[@name='cantidades_negativas']/node()}"/>
		<input type="hidden" name="REDONDEO_UNIDADES" value="{document($doc)/translation/texts/item[@name='redondeo_unidades']/node()}"/>
		<input type="hidden" name="REDONDEO_UNIDADES_2" value="{document($doc)/translation/texts/item[@name='redondeo_unidades_2']/node()}"/>
		<input type="hidden" name="UNIDADES" value="{document($doc)/translation/texts/item[@name='unidades_2']/node()}"/>
		<input type="hidden" name="CAJAS" value="{document($doc)/translation/texts/item[@name='cajas']/node()}"/>
		<input type="hidden" name="CAMBIOS_CANTIDADES_INICIO" value="{document($doc)/translation/texts/item[@name='cambios_cantidades_inicio']/node()}"/>
		<input type="hidden" name="MODIFICACIONES_CINCO_LINEAS" value="{document($doc)/translation/texts/item[@name='modificaciones_cinco_lineas']/node()}"/>
		<input type="hidden" name="MODIFICADO_CANTIDADES" value="{document($doc)/translation/texts/item[@name='modificado_cantidades']/node()}"/>
		<input type="hidden" name="LINEAS" value="{document($doc)/translation/texts/item[@name='lineas']/node()}"/>
		<input type="hidden" name="PEDIDO_NO_LLEGA" value="{document($doc)/translation/texts/item[@name='pedido_no_llega']/node()}"/>
		<input type="hidden" name="EUROS" value="{document($doc)/translation/texts/item[@name='euros']/node()}"/>
		<input type="hidden" name="POR_FAVOR_REVISE" value="{document($doc)/translation/texts/item[@name='por_favor_revise']/node()}"/>
		<input type="hidden" name="SOL_MUESTRAS" value="{document($doc)/translation/texts/item[@name='sol_muestras']/node()}"/>
		<input type="hidden" name="PEDIDO_SUPERA_DIESMIL" value="{document($doc)/translation/texts/item[@name='pedido_supera_diesmil']/node()}"/>
		<input type="hidden" name="CANTIDAD_ANTERIOR" value="{document($doc)/translation/texts/item[@name='cantidad_anterior']/node()}"/>
		<input type="hidden" name="UNIDADES_NUEVA_CANTIDAD" value="{document($doc)/translation/texts/item[@name='unidades_nueva_cantidad']/node()}"/>
		<input type="hidden" name="UNIDADES_CORRESPONDE_A" value="{document($doc)/translation/texts/item[@name='unidades_corresponde_a']/node()}"/>
		<input type="hidden" name="SON_TODAS_NEGATIVAS" value="{document($doc)/translation/texts/item[@name='son_todas_negativas']/node()}"/>
		<input type="hidden" name="VERIFIQUE_CANTIDADES_ABONO" value="{document($doc)/translation/texts/item[@name='verifique_cantidades_abono']/node()}"/>
		<input type="hidden" name="SOLICITUD_DE_PRESUPUESTO" value="{document($doc)/translation/texts/item[@name='solicitud_de_presupuesto']/node()}"/>
		<!--FIN MENSAJE JS-->
	</form>

	<xsl:apply-templates select="Analizar/ANALISIS/LINEAS">
			<xsl:with-param name="OcultarPrecioReferencia" select="$OcultarPrecioReferencia"/>
	</xsl:apply-templates>

        <!-- detalle de producto -->
	<div class="overlay-container">
		<div class="window-container zoomout">
			<p style="text-align:right;margin-bottom:5px;">
                            <a href="javascript:showTabla(false);" style="text-decoration:none;"><img src="http://www.newco.dev.br/images/cerrar.gif" /></a>
                            <a href="javascript:showTabla(false);"><xsl:value-of select="document($doc)/translation/texts/item[@name='cerrar']/node()"/></a>
                        </p>
			<table class="infoTable incidencias" id="detalleProd" cellspacing="5" style="border-collapse:none; border:2px solid #7d7d7d;" >
			<tbody>

                        </tbody>
			</table>
		</div>
	</div>
	<!-- detalle de producto-->

</xsl:otherwise>
</xsl:choose>
</body>
</html>
</xsl:otherwise>
</xsl:choose>
</xsl:template>

<xsl:template match="LISTA">
	<!--idioma-->
	<xsl:variable name="lang">
		<xsl:choose>
		<xsl:when test="/Analizar/LANG"><xsl:value-of select="/Analizar/LANG"/></xsl:when>
		<xsl:otherwise>spanish</xsl:otherwise>
		</xsl:choose>
	</xsl:variable>
	<xsl:variable name="doc">http://www.newco.dev.br/General/texts_<xsl:value-of select="$lang"/>.xml</xsl:variable>
	<!--idioma fin-->

	<h1 class="titlePage">
		<span id="titulo"><xsl:value-of select="document($doc)/translation/texts/item[@name='preparacion_pedido']/node()"/></span>
		<xsl:text>&nbsp;a&nbsp;</xsl:text>

		<xsl:choose>
		<xsl:when test="/Analizar/ANALISIS/LINEAS/LINEA_ROW[1]/PRODUCTOS/PRODUCTOS_ROW/CENTROPROVEEDOR != ''">
                    <xsl:value-of select="/Analizar/ANALISIS/LINEAS/LINEA_ROW[1]/PRODUCTOS/PRODUCTOS_ROW/CENTROPROVEEDOR"/>
                    <xsl:if test="/Analizar/ANALISIS/LINEAS/LINEA_ROW[1]/PRODUCTOS/PRODUCTOS_ROW/VENDEDOR != ''">
                        &nbsp;(<xsl:value-of select="/Analizar/ANALISIS/LINEAS/LINEA_ROW[1]/PRODUCTOS/PRODUCTOS_ROW/VENDEDOR"/>)
                    </xsl:if>
                </xsl:when>
		<xsl:otherwise><xsl:value-of select="LP_NOMBRE"/></xsl:otherwise>
		</xsl:choose>
	</h1>

	<div class="divLeft">
		<table class="infoTable" border="0">
			<form name="formBot" method="POST">
				<input type="hidden" name="LP_PLAZOENTREGA" value="{//Analizar/ANALISIS/CABECERA/LISTA/LP_PLAZOENTREGA}"/>
				<input type="hidden" name="COSTE_LOGISTICA"/>

			<tr>
				<td class="labelRight">
				<xsl:choose>
				<xsl:when test="//CENTRALCOMPRAS or //MULTICENTROS">
					<xsl:value-of select="document($doc)/translation/texts/item[@name='centro_entrega']/node()"/>:
				</xsl:when>
				<xsl:otherwise>
					<xsl:value-of select="document($doc)/translation/texts/item[@name='entregar_en']/node()"/>:
				</xsl:otherwise>
				</xsl:choose>
				</td>

				<td>
				<xsl:attribute name="class">
					<xsl:choose>
					<xsl:when test="//CENTRALCOMPRAS or //MULTICENTROS">datosLeft quince</xsl:when>
					<xsl:otherwise>datosLeft zerouno</xsl:otherwise>
					</xsl:choose>
				</xsl:attribute>

				<xsl:choose>
				<xsl:when test="//CENTRALCOMPRAS or //MULTICENTROS">
					<select name="IDCENTRO" class="select200" onChange="inicializarDesplegableCentros(this.value);"/>
				</xsl:when>
				<xsl:otherwise>
<!-- DC - 28may15					<select name="IDCENTRO" class="select200" onChange="inicializarDesplegableCentros(this.value);" style="display:none;">-->
					<select name="IDCENTRO" class="select200" style="display:none;">
						<option value="{//Analizar/ANALISIS/CABECERA/LISTA/CENTRO/CEN_ID}" selected="selected"></option>
					</select>
				</xsl:otherwise>
				</xsl:choose>
				</td>

				<td class="datosLeft dies">
				<xsl:for-each select="//TODOSLUGARESENTREGA/CENTRO/LUGARESENTREGA">
					<select name="IDLUGARENTREGA_{@idCentro}" class="lugarEntrega" onChange="ActualizarTextoLugarEntrega(this.value);" style="display:none;">
					<xsl:for-each select="LUGARENTREGA">
						<option value="{ID}"><xsl:value-of select="NOMBRE"/></option>
					</xsl:for-each>
					</select>
				</xsl:for-each>

					<input type="hidden" name="IDLUGARENTREGA"/>
				</td>

				<td class="labelRight">
                                    <xsl:if test="/Analizar/ANALISIS/MOSTRARCENTROSCONSUMO">
					<xsl:value-of select="document($doc)/translation/texts/item[@name='centro_de_consumo']/node()"/>:
                                    </xsl:if>
				</td>

				<td colspan="3" class="datosLeft">
					<select name="IDCENTROCONSUMO">
                                            <xsl:attribute name="style">
                                             <xsl:choose>
                                                 <xsl:when test="/Analizar/ANALISIS/MOSTRARCENTROSCONSUMO">display:;</xsl:when>
                                                 <xsl:otherwise>display:none;</xsl:otherwise>
                                            </xsl:choose>
                                            </xsl:attribute>
                                        </select>
				</td>
			</tr>

			<tr>
				<td class="labelRight" valign="top">
					<p style="margin-top:10px;"><xsl:value-of select="document($doc)/translation/texts/item[@name='entregar_en']/node()"/>:</p>
				</td>

				<td class="textLeft" colspan="2">
					<!--direccion-->
					<xsl:call-template name="direccion"><xsl:with-param name="path" select="CENTRO"/></xsl:call-template>
				</td>

				<td class="labelRight">
					<p style="margin-top:0px;"><xsl:value-of select="document($doc)/translation/texts/item[@name='entrega']/node()"/>:</p>
				</td>

				<td class="datosLeft">
					<p style="width:70px; float:left; margin-top:5px;">
						<xsl:call-template name="field_funcion">
							<xsl:with-param name="path" select="/Analizar/field[@name='COMBO_ENTREGA']"/>
							<xsl:with-param name="IDAct" select="/Analizar/ANALISIS/CABECERA/LISTA/LP_PLAZOENTREGA"/>
							<xsl:with-param name="cambio">calculaFecha('ENTREGA',this.options[this.selectedIndex].value);</xsl:with-param>
							<xsl:with-param name="valorMinimo" select="/Analizar/ANALISIS/CABECERA/LISTA/LP_PLAZOENTREGA"/>
						</xsl:call-template>
					</p>
					<p style="width:100px; float:left; font-size:12px;">
						<script type="text/javascript">
							calFechaEntrega.dateFormat="d/M/yyyy";
							calFechaEntrega.labelCalendario='fecha de entrega';
							calFechaEntrega.minDate=new Date(formatoFecha(calculaFechaCalendarios('<xsl:value-of select="/Analizar/ANALISIS/CABECERA/LISTA/LP_PLAZOENTREGA"/>'),'E','I'));
							calFechaEntrega.writeControl();
						</script>
					</p>

					<input type="hidden" name="FECHA_DECISION" size="10" maxlength="10" value="{/Analizar/ANALISIS/CABECERA/LISTA/LP_FECHADECISION}"/>
					<input type="hidden" name="sum" size="14" readonly="readonly"/>
					<input type="hidden" name="sumBrasil" size="14" readonly="readonly"/>
					<input type="hidden" name="sumanumerica" size="14" readonly="readonly"/>
				</td>
			</tr>

			<tr style="height:5px;"><td colspan="5">&nbsp;</td></tr>

			<tr style="border-top:1px solid #396BAD;">
<!--				<input type="hidden" name="IDFORMAPAGO" value="{/Analizar/ANALISIS/CABECERA/LISTA/LP_IDFORMAPAGO}"/>-->
<!--				<input type="hidden" name="FORMAPAGO" value="{/Analizar/ANALISIS/CABECERA/LISTA/LP_FORMAPAGO}"/>-->
				<xsl:call-template name="hiddensPedido"/>
<!--				<input type="hidden" name="IDPLAZOPAGO" value="{/Analizar/ANALISIS/CABECERA/LISTA/LP_IDPLAZOPAGO}"/>-->

				<!--  pedido minimo -->
				<xsl:choose>
				<xsl:when test="//ANALISIS/PEDIDO_MINIMO/ACTIVO!='N' and //ANALISIS/PEDIDO_MINIMO/IMPORTE>0">
					<td class="datosLeft" colspan="5">
						<span style="color:#000;font-family:Verdana;font-weight:bold;margin-left:10px;">
							<xsl:value-of select="document($doc)/translation/texts/item[@name='pedido_minimo_de']/node()"/>&nbsp;
							<input type="text" id="CEN_PEDIDOMINIMO" name="CEN_PEDIDOMINIMO" size="10" value="{//ANALISIS/PEDIDO_MINIMO/IMPORTE_SINFORMATO}" class="noinput" style="text-align:left;width:55px; font-weight:bold; margin-bottom:3px;" onFocus="this.blur();"/>&nbsp;
							<xsl:value-of select="document($doc)/translation/texts/item[@name='euros']/node()"/>&nbsp;
						</span>

						<input type="hidden" id="CEN_TIPOPEDIDOMINIMO" name="CEN_TIPOPEDIDOMINIMO" size="30" value="{//ANALISIS/PEDIDO_MINIMO/ACTIVO}"/>

						<xsl:if test="//ANALISIS/PEDIDO_MINIMO/DETALLE != ''">
							<span class="font11">:&nbsp;<xsl:value-of select="//ANALISIS/PEDIDO_MINIMO/DETALLE"/></span>
						</xsl:if>
						<!--TEXTO INSERTADO SOLO PARA EL PROVEEDOR PFIZER ID_EMPRESA 7096-->
						<xsl:if test="//ANALISIS/PEDIDO_MINIMO/ACTIVO != 'E' and //ANALISIS/PEDIDO_MINIMO/IDPROVEEDOR = '7096'">
							<br />
							<span class="font11" style="width:160px;float:left;">&nbsp;</span>
							<span class="font11">-&nbsp;<xsl:value-of select="document($doc)/translation/texts/item[@name='pedido_minimo_no_estricto_expli']/node()"/>.</span>
						</xsl:if>
						<!--texto retraso-->
						<xsl:if test="RETRASO">
							<br />
							<span class="font11" style="width:160px;float:left;">&nbsp;</span>
							<span class="font11">-&nbsp;<xsl:copy-of select="document($doc)/translation/texts/item[@name='pedidos_desde_quince']/node()"/></span>
						</xsl:if>
					</td>
				</xsl:when>
				<xsl:otherwise>
					<td class="datosLeft" colspan="5">
						<input type="hidden" id="CEN_PEDIDOMINIMO" name="CEN_PEDIDOMINIMO" size="30" value="0" class="noinput"  onFocus="this.blur();"/>
						<input type="hidden" id="CEN_TIPOPEDIDOMINIMO" name="CEN_TIPOPEDIDOMINIMO" size="30" value="{//ANALISIS/PEDIDO_MINIMO/ACTIVO}" />

						<span style="color:#000;font-weight:bold;margin-left:10px;"><xsl:value-of select="//ANALISIS/PEDIDO_MINIMO/PROVEEDOR" /> <xsl:value-of select="document($doc)/translation/texts/item[@name='no_requiere_pedido_minimo']/node()"/></span>

						<xsl:if test="RETRASO">
							&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
							<span class="font11">-&nbsp;<xsl:copy-of select="document($doc)/translation/texts/item[@name='pedidos_desde_quince']/node()"/></span>
						</xsl:if>
					</td>
				</xsl:otherwise>
				</xsl:choose>
			</tr>
			</form>
		</table>
	</div><!--fin de div divLeft-->
</xsl:template>

<xsl:template match="LINEAS">
	<xsl:param name="OcultarPrecioReferencia"/>

	<!--idioma-->
	<xsl:variable name="lang">
		<xsl:choose>
		<xsl:when test="/Analizar/LANG"><xsl:value-of select="/Analizar/LANG"/></xsl:when>
		<xsl:otherwise>spanish</xsl:otherwise>
		</xsl:choose>
	</xsl:variable>
	<xsl:variable name="doc">http://www.newco.dev.br/General/texts_<xsl:value-of select="$lang"/>.xml</xsl:variable>
	<!--idioma fin-->

	<!--INICIO TABLA PRODUCTOS-->
	<table class="infoTable" border="0">
		<tr>
			<td class="datosLeft">
				<!--si pueden pedir muestras-->
				<xsl:if test="/Analizar/ANALISIS/BLOQUEARMUESTRASCLIENTE != 'S'">
					<span class="margin25">
						<span class="camposObligatorios">*</span>&nbsp;
<!-- DC - 30jul15 - Ahora se muestra un alert para que la solicitud de muestras pase por 'evaluacion de producto'
						<a href="javascript:PrepararSolicitudMuestras();">
-->
						<xsl:variable name="textAlert"><xsl:value-of select="document($doc)/translation/texts/item[@name='mensaje_solicitud_muestras_en_pedidos']/node()"/></xsl:variable>
						<a href="javascript:alert('{$textAlert}');">
							<xsl:value-of select="document($doc)/translation/texts/item[@name='solicitar_muestras']/node()"/>
						</a>
					</span>
				</xsl:if>
			</td>

			<td class="labelRight">
				<a href="javascript:window.print();"><img src="http://www.newco.dev.br/images/imprimir.gif" alt="Imprimir" title="Imprimir" /><xsl:value-of select="document($doc)/translation/texts/item[@name='imprimir']/node()"/></a>&nbsp;&nbsp;&nbsp;&nbsp;
			</td>
		</tr>
	</table>

<xsl:variable name="nuevoModeloNegocio">
	<xsl:choose>
	<xsl:when test="/Analizar/ANALISIS/MOSTRAR_PRECIO_REFERENCIA/@NuevoModeloNegocio != ''">
		<xsl:value-of select="/Analizar/ANALISIS/MOSTRAR_PRECIO_REFERENCIA/@NuevoModeloNegocio"/>
	</xsl:when>
	<xsl:when test="/Analizar/ANALISIS/OCULTAR_PRECIO_REFERENCIA/@NuevoModeloNegocio != ''">
		<xsl:value-of select="/Analizar/ANALISIS/OCULTAR_PRECIO_REFERENCIA/@NuevoModeloNegocio"/>
	</xsl:when>
	</xsl:choose>
</xsl:variable>

<xsl:variable name="pedidoAntiguo">
	<xsl:choose>
	<xsl:when test="/Analizar/ANALISIS/MOSTRAR_PRECIO_REFERENCIA/@PedidoAntiguo != ''">
		<xsl:value-of select="/Analizar/ANALISIS/MOSTRAR_PRECIO_REFERENCIA/@PedidoAntiguo"/>
	</xsl:when>
	<xsl:when test="/Analizar/ANALISIS/OCULTAR_PRECIO_REFERENCIA/@PedidoAntiguo != ''">
		<xsl:value-of select="/Analizar/ANALISIS/OCULTAR_PRECIO_REFERENCIA/@PedidoAntiguo"/>
	</xsl:when>
	</xsl:choose>
</xsl:variable>

<xsl:choose>
<!--ASISA Y BRASIL VIEJO MODELO PRECIO PROV SIN IVA-->
<xsl:when test="($nuevoModeloNegocio = 'N' and $pedidoAntiguo = 'N' and not(/Analizar/ANALISIS/MOSTRAR_PRECIO_CON_IVA)) or /Analizar/ANALISIS/IDPAIS = '55'">
	<!--asisa brasil-->
	<xsl:call-template name="asisaBrasilTablaProd"/>
</xsl:when>
<!--VIAMED NUEVO VIEJO MODELO PERO VEO PRECIO PROV CON IVA-->
<xsl:when test="$nuevoModeloNegocio = 'N' and $pedidoAntiguo = 'N' and /Analizar/ANALISIS/MOSTRAR_PRECIO_CON_IVA">
	<!--viamed nuevo--><xsl:call-template name="viamedNuevoTablaProd"/>
</xsl:when>
<!--NUEVO MODELO VIEJO PEDIDO alicante...PRECIO CON IVA-->
<xsl:when test="$nuevoModeloNegocio = 'S' and $pedidoAntiguo = 'S'">
	<!--nuevo modelo viejo pedido vissum alicante-->
	<xsl:call-template name="nuevoModeloViejoPedidoTablaProd"/>
</xsl:when>
<!--NUEVO MODELO NUEVO PEDIDO - PARA VIAMED VIEJO, VENDRELL...VEO PRECIO FINAL-->
<xsl:when test="$nuevoModeloNegocio = 'S' and $pedidoAntiguo = 'N'">
	<!--vendrell viamed viejo gomosa-->
	<xsl:call-template name="nuevoModeloNuevoPedidoTablaProd"/>
</xsl:when>
</xsl:choose>

<br /><br />
</xsl:template>

<!--ASISA Y BRASIL VIEJO MODELO PRECIO PROV SIN IVA-->
<xsl:template name="asisaBrasilTablaProd">
<!--idioma-->
<xsl:variable name="lang">
	<xsl:choose>
	<xsl:when test="/Analizar/LANG"><xsl:value-of select="/Analizar/LANG" /></xsl:when>
	<xsl:otherwise>spanish</xsl:otherwise>
	</xsl:choose>
</xsl:variable>
<xsl:variable name="doc">http://www.newco.dev.br/General/texts_<xsl:value-of select="$lang"/>.xml</xsl:variable>
<!--idioma fin-->

<!--ocultar precio ref-->
<xsl:variable name="OcultarPrecioReferencia"><xsl:value-of select="/Analizar/ANALISIS/OCULTAR_PRECIO_REFERENCIA/@Ocultar"/></xsl:variable>

	<!--inicio tabla productos-->
	<table class="encuesta" border="0">
	<thead>
		<tr class="titulosNoAlto">
			<!-- ref mvm + provee -->
			<th class="ocho" align="left">
			<xsl:choose>
			<xsl:when test="LINEA_ROW/PRODUCTOS/PRODUCTOS_ROW[1]/PRO_CATEGORIA = 'F' and /Analizar/ANALISIS/UTILIZAR_REFERENCIA_PROVEEDOR">
				&nbsp;<xsl:value-of select="document($doc)/translation/texts/item[@name='codigo_nacional']/node()"/>
			</xsl:when>
			<xsl:otherwise>
				<xsl:value-of select="document($doc)/translation/texts/item[@name='ref_cliente']/node()"/>.
			</xsl:otherwise>
			</xsl:choose>
			</th>
                        <th class="dos">&nbsp;<!--image--></th>
			<!-- producto -->
			<th align="left">
				<xsl:value-of select="document($doc)/translation/texts/item[@name='producto']/node()"/>
				<span style="padding-left:5px;"><input type="text" name="strFiltro" id="strFiltro" size="20"/></span>
				&nbsp;<a href="javascript:ordenarProductos();"><xsl:value-of select="document($doc)/translation/texts/item[@name='solo_productos']/node()"/></a>
			</th>

			<!-- ref provee-->
			<th class="center">
			<xsl:attribute name="class">
				<xsl:choose>
				<!--si es viamed5 ve ref.prov-->
				<xsl:when test="LINEA_ROW/PRODUCTOS/PRODUCTOS_ROW[1]/PRO_CATEGORIA = 'F' and not(/Analizar/ANALISIS/UTILIZAR_REFERENCIA_PROVEEDOR)">ocho</xsl:when>
				<xsl:when test="LINEA_ROW/PRODUCTOS/PRODUCTOS_ROW[1]/PRO_CATEGORIA = 'F'  and /Analizar/ANALISIS/UTILIZAR_REFERENCIA_PROVEEDOR">zerouno</xsl:when>
				<xsl:when test="LINEA_ROW/PRODUCTOS/PRODUCTOS_ROW[1]/PRO_CATEGORIA = 'N'">ocho</xsl:when>
				</xsl:choose>
			</xsl:attribute>

			<xsl:choose>
			<!--si es farmacia no veo ref prov, solo si es viamed5 veo ref prov-->
			<xsl:when test="LINEA_ROW/PRODUCTOS/PRODUCTOS_ROW[1]/PRO_CATEGORIA = 'F' and not(/Analizar/ANALISIS/UTILIZAR_REFERENCIA_PROVEEDOR)">
				<xsl:value-of select="document($doc)/translation/texts/item[@name='ref_prov']/node()"/>
			</xsl:when>
			<!--si no es viamed5 no veo ref prov-->
			<xsl:when test="LINEA_ROW/PRODUCTOS/PRODUCTOS_ROW[1]/PRO_CATEGORIA = 'F'  and /Analizar/ANALISIS/UTILIZAR_REFERENCIA_PROVEEDOR">
			</xsl:when>
			<xsl:when test="LINEA_ROW/PRODUCTOS/PRODUCTOS_ROW[1]/PRO_CATEGORIA = 'N'">
				<xsl:value-of select="document($doc)/translation/texts/item[@name='ref_prov']/node()"/>
			</xsl:when>
			</xsl:choose>
			</th>

			<!--marca para todos 26/06/12-->
			<th>
			<xsl:attribute name="class">
				<xsl:choose>
				<xsl:when test="/Analizar/ANALISIS/SIN_MARCA">zerouno</xsl:when>
				<xsl:when test="LINEA_ROW/PRODUCTOS/PRODUCTOS_ROW[1]/PRO_CATEGORIA = 'F' and /Analizar/ANALISIS/UTILIZAR_REFERENCIA_PROVEEDOR">quince</xsl:when>
				<!--si es farmacia y viamed5 mas estrecho-->
				<xsl:when test="LINEA_ROW/PRODUCTOS/PRODUCTOS_ROW[1]/PRO_CATEGORIA = 'F' and not(/Analizar/ANALISIS/UTILIZAR_REFERENCIA_PROVEEDOR)">dies</xsl:when>
				<xsl:when test="LINEA_ROW/PRODUCTOS/PRODUCTOS_ROW[1]/PRO_CATEGORIA = 'N'">ocho</xsl:when>
				</xsl:choose>
			</xsl:attribute>

			<xsl:choose>
			<xsl:when test="/Analizar/ANALISIS/SIN_MARCA"></xsl:when>
			<xsl:otherwise>
				<xsl:value-of select="document($doc)/translation/texts/item[@name='marca']/node()"/>
			</xsl:otherwise>
			</xsl:choose>
			</th>

			<!-- ud base -->
			<th>
			<xsl:attribute name="class">
				<xsl:choose>
				<!--si es farmacia mas estrecho-->
				<xsl:when test="LINEA_ROW/PRODUCTOS/PRODUCTOS_ROW[1]/PRO_CATEGORIA = 'F' and not(/Analizar/ANALISIS/UTILIZAR_REFERENCIA_PROVEEDOR)">ocho</xsl:when>
				<xsl:otherwise>doce</xsl:otherwise>
				</xsl:choose>
			</xsl:attribute>

				<xsl:value-of select="document($doc)/translation/texts/item[@name='ud_basica']/node()"/>
			</th>

		<!-- precio ud base, solo viejo modelo -->
		<xsl:if test="$OcultarPrecioReferencia='N' or /Analizar/ANALISIS/IDPAIS = '55'">
			<th class="cuatro">
				<xsl:copy-of select="document($doc)/translation/texts/item[@name='precio_s_iva']/node()"/>
			</th>
		</xsl:if>

			<!-- cantidad -->
			<th class="cinco">
				<xsl:value-of select="document($doc)/translation/texts/item[@name='unidades']/node()"/>
			</th>

			<!-- lote -->
			<th class="tres">
				<xsl:value-of select="document($doc)/translation/texts/item[@name='embalaje']/node()"/>
			</th>

		<!-- iva ense�o solo para asisa-->
		<!--si es brasil no ense�o iva-->
		<xsl:choose>
		<xsl:when test="/Analizar/ANALISIS/IDPAIS = '55'">
			<th class="zerouno">&nbsp;</th>
		</xsl:when>
		<xsl:otherwise>
			<th class="uno">
				&nbsp;&nbsp;<xsl:value-of select="document($doc)/translation/texts/item[@name='iva']/node()"/>
			</th>
		</xsl:otherwise>
		</xsl:choose>

			<!-- importe -->
			<th class="dos" align="right">
				<xsl:copy-of select="document($doc)/translation/texts/item[@name='importe_s_iva_2line']/node()"/>
			</th>

			<!-- importe total linea-->
			<th class="uno">
				<xsl:value-of select="document($doc)/translation/texts/item[@name='sel']/node()"/><br />
				<input type="checkbox" name="SOLO_SELECCIONADOS" value="1" onClick="mostrarSeleccionados(this);"/>
			</th>
		</tr>
	</thead>
	<!--fin de titulos-->

	<!-- Aqui se montan dinamicamente las lineas de productos para generar el pedido -->
	<tbody></tbody>

	<tfoot>
		<tr>
			<td colspan="11">&nbsp;</td>
		</tr>

		<!--form sumaTotal + coste transporte brasil-->
		<form name="sumaTotal">
		<tr>
			<td class="textRight" colspan="6">&nbsp;</td>
			<!--choose pais-->
			<xsl:choose>
			<!--si es brasil pongo subtotal-->
			<xsl:when test="/Analizar/ANALISIS/IDPAIS = '55'">
				<td class="textRight" colspan="2">
					<strong><xsl:value-of select="document($doc)/translation/texts/item[@name='subtotal']/node()"/>:</strong>
				</td>
				<td colspan="2" class="textRight">
					<input type="text" class="noinput" name="sumaTotal" size="10" maxlength="12" style="text-align:right;" onFocus="this.blur();" value="0,00"/>
				</td>
			</xsl:when><!--fin si es brasil-->
			<!--si es espa�a-->
			<xsl:otherwise>
				<td class="textRight" colspan="2">
					<strong><xsl:value-of select="document($doc)/translation/texts/item[@name='total']/node()"/>:</strong>
				</td>
				<td class="textRight" colspan="2">
					<input type="text" class="noinput" name="sumaTotal" size="10" maxlength="12" style="text-align:right;" onFocus="this.blur();" value="0,00"/>
				</td>

				<input type="hidden" class="noinput" name="sumaTotalBrasil" size="10" maxlength="12" style="text-align:right;" onFocus="this.blur();"/>
				<input type="hidden" class="noinput" name="COSTE_LOGISTICA" size="8" maxlength="12" style="text-align:right;" value="0"/>
			</xsl:otherwise>
			</xsl:choose><!--fin choose pais-->

			<td>&nbsp;</td>
		</tr>

	<!--coste de transporte + suma total brasil-->
	<xsl:if test="/Analizar/ANALISIS/IDPAIS = '55'">
		<tr>
			<td colspan="6">&nbsp;</td>
			<td class="textRight" colspan="2">
				<strong><xsl:value-of select="document($doc)/translation/texts/item[@name='coste_trasporte']/node()"/>:</strong>
			</td>
			<td colspan="2" class="textRight">
				<input type="text" class="noinput" name="COSTE_LOGISTICA" size="8" maxlength="12" style="text-align:right;" value="0,00"/>
			</td>
			<td>&nbsp;</td>
		</tr>

		<tr>
			<td colspan="6"></td>
			<td class="textRight" colspan="2">
				<strong><xsl:value-of select="document($doc)/translation/texts/item[@name='total']/node()"/>:</strong>
			</td>
			<td colspan="2" class="textRight">
				<input type="text" class="noinput" name="sumaTotalBrasil" size="10" maxlength="12" style="text-align:right;" onFocus="this.blur();" value="0,00"/>
			</td>
			<td>&nbsp;</td>
		</tr>
	</xsl:if>
		</form>

		<tr><td colspan="11">&nbsp;</td></tr>

		<!-- Botones -->
		<tr>
			<td colspan="7">
			<!--solo para no asisa, no asisa = S => != N-->
			<xsl:if test="$OcultarPrecioReferencia!='N'">
				<span class="font11">&nbsp;<img src="http://www.newco.dev.br/images/order_d_verde.gif"/>&nbsp;<xsl:value-of select="document($doc)/translation/texts/item[@name='precio_producto_bajado_desde_ultimo_pedido']/node()"/>.</span><br />
				<span class="font11">&nbsp;<img src="http://www.newco.dev.br/images/order_a_rojo.gif"/>&nbsp;<xsl:value-of select="document($doc)/translation/texts/item[@name='precio_producto_subido_desde_ultimo_pedido']/node()"/>.</span>
			</xsl:if>
			</td>

			<td colspan="4">
			<xsl:choose>
			<xsl:when test="//ANALISIS/PEDIDO_MINIMO/IMPORTE != '0' and //ANALISIS/PEDIDO_MINIMO/IMPORTE != ''">
				<div class="boton" id="divContinuar">
<!-- DC - Hacemos limpieza de la funcion controlPedido
					<a href="javascript:controlPedido(document.forms['formBot'],document.forms,'LPAnalizarSave.xsql',{//ANALISIS/PEDIDO_MINIMO/IMPORTE});" title="Continuar" id="botonContinuar"><xsl:value-of select="document($doc)/translation/texts/item[@name='continuar']/node()"/></a>
-->
					<a href="javascript:controlPedido();" title="Continuar" id="botonContinuar"><xsl:value-of select="document($doc)/translation/texts/item[@name='continuar']/node()"/></a>
				</div>
			</xsl:when>
			<xsl:otherwise>
				<div class="boton" id="divContinuar">
<!-- DC - Hacemos limpieza de la funcion controlPedido
					<a href="javascript:Actua(document.forms['formBot'],document.forms,'LPAnalizarSave.xsql');" title="Continuar" id="botonContinuar"><xsl:value-of select="document($doc)/translation/texts/item[@name='continuar']/node()"/></a>
-->
					<a href="javascript:Actua();" title="Continuar" id="botonContinuar"><xsl:value-of select="document($doc)/translation/texts/item[@name='continuar']/node()"/></a>
				</div>
			</xsl:otherwise>
			</xsl:choose>
			</td>
		</tr>
	</tfoot>
	</table><!--fin de encuesta tabla-->
</xsl:template>

<!--VIAMED NUEVO VIEJO MODELO PERO VEO PRECIO PROV CON IVA-->
<xsl:template name="viamedNuevoTablaProd">
	<!--idioma-->
	<xsl:variable name="lang">
		<xsl:choose>
		<xsl:when test="/Analizar/LANG"><xsl:value-of select="/Analizar/LANG" /></xsl:when>
		<xsl:otherwise>spanish</xsl:otherwise>
		</xsl:choose>
	</xsl:variable>
	<xsl:variable name="doc">http://www.newco.dev.br/General/texts_<xsl:value-of select="$lang"/>.xml</xsl:variable>
	<!--idioma fin-->

	<!--ocultar precio ref-->
	<xsl:variable name="OcultarPrecioReferencia"><xsl:value-of select="/Analizar/ANALISIS/OCULTAR_PRECIO_REFERENCIA/@Ocultar"/></xsl:variable>

	<!--inicio tabla productos-->
	<table class="encuesta" border="0">
	<thead>
		<tr class="titulosNoAlto">
			<!-- ref mvm + provee -->
			<th class="cinco" align="left">
			<xsl:choose>
			<xsl:when test="LINEA_ROW/PRODUCTOS/PRODUCTOS_ROW[1]/PRO_CATEGORIA = 'F' and /Analizar/ANALISIS/UTILIZAR_REFERENCIA_PROVEEDOR">
				&nbsp;<xsl:value-of select="document($doc)/translation/texts/item[@name='codigo_nacional']/node()"/>
			</xsl:when>
			<xsl:otherwise>
				<xsl:value-of select="document($doc)/translation/texts/item[@name='ref_cliente']/node()"/>.
			</xsl:otherwise>
			</xsl:choose>
			</th>
                        <th class="dos">&nbsp;<!--image--></th>
			<!-- producto -->
			<th align="left">
				<xsl:value-of select="document($doc)/translation/texts/item[@name='producto']/node()"/>
				<span style="padding-left:5px;"><input type="text" name="strFiltro" id="strFiltro" size="20"/></span>
			</th>

			<!-- ref provee-->
			<th class="center">
			<xsl:attribute name="class">
				<xsl:choose>
				<!--si es viamed5 ve ref.prov-->
				<xsl:when test="LINEA_ROW/PRODUCTOS/PRODUCTOS_ROW[1]/PRO_CATEGORIA = 'F' and not(/Analizar/ANALISIS/UTILIZAR_REFERENCIA_PROVEEDOR)">quince</xsl:when>
				<xsl:when test="LINEA_ROW/PRODUCTOS/PRODUCTOS_ROW[1]/PRO_CATEGORIA = 'F'  and /Analizar/ANALISIS/UTILIZAR_REFERENCIA_PROVEEDOR">zerouno</xsl:when>
				<xsl:when test="LINEA_ROW/PRODUCTOS/PRODUCTOS_ROW[1]/PRO_CATEGORIA = 'N'">quince</xsl:when>
				</xsl:choose>
			</xsl:attribute>

			<xsl:choose>
			<!--si es farmacia no veo ref prov, solo si es viamed5 veo ref prov-->
			<xsl:when test="LINEA_ROW/PRODUCTOS/PRODUCTOS_ROW[1]/PRO_CATEGORIA = 'F' and not(/Analizar/ANALISIS/UTILIZAR_REFERENCIA_PROVEEDOR)">
				<xsl:value-of select="document($doc)/translation/texts/item[@name='ref_prov']/node()"/>
			</xsl:when>
			<!--si no es viamed5 no veo ref prov-->
			<xsl:when test="LINEA_ROW/PRODUCTOS/PRODUCTOS_ROW[1]/PRO_CATEGORIA = 'F'  and /Analizar/ANALISIS/UTILIZAR_REFERENCIA_PROVEEDOR">
			</xsl:when>
			<xsl:when test="LINEA_ROW/PRODUCTOS/PRODUCTOS_ROW[1]/PRO_CATEGORIA = 'N'">
				<xsl:value-of select="document($doc)/translation/texts/item[@name='ref_prov']/node()"/>
			</xsl:when>
			</xsl:choose>
			</th>

			<!--marca solo si es asisa, para todos 26/06/12-->
			<th>
			<xsl:attribute name="class">
				<xsl:choose>
				<xsl:when test="/Analizar/ANALISIS/SIN_MARCA">zerouno</xsl:when>
				<xsl:when test="LINEA_ROW/PRODUCTOS/PRODUCTOS_ROW[1]/PRO_CATEGORIA = 'F' and /Analizar/ANALISIS/UTILIZAR_REFERENCIA_PROVEEDOR">quince</xsl:when>
				<!--si es farmacia y viamed5 mas estrecho-->
				<xsl:when test="LINEA_ROW/PRODUCTOS/PRODUCTOS_ROW[1]/PRO_CATEGORIA = 'F' and not(/Analizar/ANALISIS/UTILIZAR_REFERENCIA_PROVEEDOR)">dies</xsl:when>
				<xsl:when test="LINEA_ROW/PRODUCTOS/PRODUCTOS_ROW[1]/PRO_CATEGORIA = 'N'">ocho</xsl:when>
				</xsl:choose>
			</xsl:attribute>

			<xsl:choose>
			<xsl:when test="/Analizar/ANALISIS/SIN_MARCA"></xsl:when>
			<xsl:otherwise>
				<xsl:value-of select="document($doc)/translation/texts/item[@name='marca']/node()"/>
			</xsl:otherwise>
			</xsl:choose>
			</th>

			<!-- ud base -->
			<th>
			<xsl:attribute name="class">
				<xsl:choose>
				<!--si es farmacia y viamed5 mas estrecho-->
				<xsl:when test="LINEA_ROW/PRODUCTOS/PRODUCTOS_ROW[1]/PRO_CATEGORIA = 'F' and not(/Analizar/ANALISIS/UTILIZAR_REFERENCIA_PROVEEDOR)">ocho</xsl:when>
				<xsl:otherwise>doce</xsl:otherwise>
				</xsl:choose>
			</xsl:attribute>

				<xsl:value-of select="document($doc)/translation/texts/item[@name='ud_basica']/node()"/>
			</th>

			<!-- precio ud base con IVA -->
			<th class="cuatro">
				<xsl:copy-of select="document($doc)/translation/texts/item[@name='precio_c_iva']/node()"/>
			</th>

			<!--flechas si precio ha bajado o subido solo para no asisa-->
			<th class="zerouno">&nbsp;</th>

			<!-- cantidad -->
			<th class="cinco">
				<xsl:value-of select="document($doc)/translation/texts/item[@name='unidades']/node()"/>
			</th>

			<!-- lote -->
			<th class="tres">
				<xsl:value-of select="document($doc)/translation/texts/item[@name='embalaje']/node()"/>
			</th>

			<!--iva-->
			<th class="uno">&nbsp;</th>

			<!-- importe con iva-->
			<th class="dos" align="right">
				<xsl:copy-of select="document($doc)/translation/texts/item[@name='importe_c_iva_2line']/node()"/>
			</th>

			<!-- seleccionado -->
			<th class="uno">
				<xsl:value-of select="document($doc)/translation/texts/item[@name='sel']/node()"/><br />
				<input type="checkbox" name="SOLO_SELECCIONADOS" value="1" onClick="mostrarSeleccionados(this);"/>
			</th>
		</tr>
	</thead>
	<!--fin de titulos-->

	<!-- Aqui se montan dinamicamente las lineas de productos para generar el pedido -->
	<tbody></tbody>

	<tfoot>
		<tr>
			<td>
				<xsl:attribute name="colspan">
					<xsl:choose>
					<xsl:when test="$OcultarPrecioReferencia='N'">15</xsl:when>
					<xsl:otherwise>12</xsl:otherwise>
					</xsl:choose>
				</xsl:attribute>
			</td>
		</tr>

	<!--form sumaTotal + coste transporte brasil-->
	<form name="sumaTotal">
		<input type="hidden" name="sumaTotalBrasil"/>
		<input type="hidden" name="COSTE_LOGISTICA" value="0"/>

		<tr>
			<td class="textRight" colspan="8">&nbsp;</td>
			<!--subtotal-->
			<td class="textRight" colspan="2">
				<strong><xsl:value-of select="document($doc)/translation/texts/item[@name='total']/node()"/>:</strong>
			</td>
			<td class="textRight" colspan="2">
				<input type="text" class="noinput" name="sumaTotal" size="10" maxlength="12" style="text-align:right;" onFocus="this.blur();" value="0,00"/>
			</td>
			<td colspan="2">&nbsp;</td>
		</tr>
	</form>

		<tr><td colspan="13">&nbsp;</td></tr>

		<!-- Botones -->
		<tr>
			<td colspan="9">
			<xsl:if test="$OcultarPrecioReferencia='S'">
				<span class="font11">&nbsp;&nbsp;<xsl:value-of select="document($doc)/translation/texts/item[@name='comision_mvm_iva']/node()"/></span><br />
			</xsl:if>

			<!--solo para no asisa, no asisa = S => != N-->
			<xsl:if test="$OcultarPrecioReferencia!='N'">
				<span class="font11">&nbsp;<img src="http://www.newco.dev.br/images/order_d_verde.gif"/>&nbsp;<xsl:value-of select="document($doc)/translation/texts/item[@name='precio_producto_bajado_desde_ultimo_pedido']/node()"/>.</span><br />
				<span class="font11">&nbsp;<img src="http://www.newco.dev.br/images/order_a_rojo.gif"/>&nbsp;<xsl:value-of select="document($doc)/translation/texts/item[@name='precio_producto_subido_desde_ultimo_pedido']/node()"/>.</span>
			</xsl:if>
			</td>

			<td colspan="3">
			<xsl:choose>
			<xsl:when test="//ANALISIS/PEDIDO_MINIMO/IMPORTE != '0' and //ANALISIS/PEDIDO_MINIMO/IMPORTE != ''">
				<div class="boton" id="divContinuar">
					<a href="javascript:controlPedido(document.forms['formBot'],document.forms,'LPAnalizarSave.xsql',{//ANALISIS/PEDIDO_MINIMO/IMPORTE});" title="Continuar" id="botonContinuar"><xsl:value-of select="document($doc)/translation/texts/item[@name='continuar']/node()"/></a>
				</div>
			</xsl:when>
			<xsl:otherwise>
				<div class="boton" id="divContinuar">
					<a href="javascript:Actua(document.forms['formBot'],document.forms,'LPAnalizarSave.xsql');" title="Continuar" id="botonContinuar"><xsl:value-of select="document($doc)/translation/texts/item[@name='continuar']/node()"/></a>
				</div>
			</xsl:otherwise>
			</xsl:choose>
			</td>

			<td>&nbsp;</td>
		</tr>
	</tfoot>
	</table><!--fin de encuesta tabla-->
</xsl:template>

<!--VISSUM ALICANTE - NUEVO MODELO - VIEJO PEDIDO - VEO PRECIO CON IVA Y SIN IVA-->
<xsl:template name="nuevoModeloViejoPedidoTablaProd">
<!--idioma-->
<xsl:variable name="lang">
	<xsl:choose>
	<xsl:when test="/Analizar/LANG"><xsl:value-of select="/Analizar/LANG"/></xsl:when>
	<xsl:otherwise>spanish</xsl:otherwise>
	</xsl:choose>
</xsl:variable>
<xsl:variable name="doc">http://www.newco.dev.br/General/texts_<xsl:value-of select="$lang"/>.xml</xsl:variable>
<!--idioma fin-->

<!--ocultar precio ref-->
<xsl:variable name="OcultarPrecioReferencia"><xsl:value-of select="/Analizar/ANALISIS/OCULTAR_PRECIO_REFERENCIA/@Ocultar"/></xsl:variable>

	<!--inicio tabla productos-->
	<table class="encuesta" border="0">
	<thead>
		<tr class="titulosNoAlto">
			<!-- ref mvm + provee -->
			<th class="ocho" align="left">
			<xsl:choose>
			<xsl:when test="LINEA_ROW/PRODUCTOS/PRODUCTOS_ROW[1]/PRO_CATEGORIA = 'F' and /Analizar/ANALISIS/UTILIZAR_REFERENCIA_PROVEEDOR">
				&nbsp;<xsl:value-of select="document($doc)/translation/texts/item[@name='codigo_nacional']/node()"/>
			</xsl:when>
			<xsl:otherwise>
				&nbsp;<xsl:value-of select="document($doc)/translation/texts/item[@name='ref_cliente']/node()"/>.
			</xsl:otherwise>
			</xsl:choose>
			</th>
                        <th class="dos">&nbsp;<!--image--></th>
			<!-- producto -->
			<th align="left">
				<xsl:value-of select="document($doc)/translation/texts/item[@name='producto']/node()"/>
				<span style="padding-left:5px;"><input type="text" name="strFiltro" id="strFiltro" size="20"/></span>
			</th>

			<!-- ref provee-->
			<th class="center">
				<xsl:attribute name="class">
					<xsl:choose>
					<!--si es viamed5 ve ref.prov-->
					<xsl:when test="LINEA_ROW/PRODUCTOS/PRODUCTOS_ROW[1]/PRO_CATEGORIA = 'F' and not(/Analizar/ANALISIS/UTILIZAR_REFERENCIA_PROVEEDOR)">ocho</xsl:when>
					<xsl:when test="LINEA_ROW/PRODUCTOS/PRODUCTOS_ROW[1]/PRO_CATEGORIA = 'F'  and /Analizar/ANALISIS/UTILIZAR_REFERENCIA_PROVEEDOR">zerouno</xsl:when>
					<xsl:when test="LINEA_ROW/PRODUCTOS/PRODUCTOS_ROW[1]/PRO_CATEGORIA = 'N'">ocho</xsl:when>
					</xsl:choose>
				</xsl:attribute>

			<xsl:choose>
			<!--si es farmacia no veo ref prov-->
			<xsl:when test="LINEA_ROW/PRODUCTOS/PRODUCTOS_ROW[1]/PRO_CATEGORIA = 'F'"></xsl:when>
			<xsl:when test="LINEA_ROW/PRODUCTOS/PRODUCTOS_ROW[1]/PRO_CATEGORIA = 'N'">
				<xsl:value-of select="document($doc)/translation/texts/item[@name='ref_prov']/node()"/>
			</xsl:when>
			</xsl:choose>
			</th>

			<th>
				<xsl:attribute name="class">
					<xsl:choose>
					<xsl:when test="/Analizar/ANALISIS/SIN_MARCA">zerouno</xsl:when>
					<xsl:when test="LINEA_ROW/PRODUCTOS/PRODUCTOS_ROW[1]/PRO_CATEGORIA = 'F'">quince</xsl:when>
					<xsl:when test="LINEA_ROW/PRODUCTOS/PRODUCTOS_ROW[1]/PRO_CATEGORIA = 'N'">ocho</xsl:when>
					</xsl:choose>
				</xsl:attribute>

			<xsl:choose>
			<xsl:when test="/Analizar/ANALISIS/SIN_MARCA"></xsl:when>
			<xsl:otherwise>
				<xsl:value-of select="document($doc)/translation/texts/item[@name='marca']/node()"/>
			</xsl:otherwise>
			</xsl:choose>
			</th>

			<!-- ud base -->
			<th>
				<xsl:attribute name="class">
					<xsl:choose>
					<!--si es farmacia y viamed5 mas estrecho-->
					<xsl:when test="LINEA_ROW/PRODUCTOS/PRODUCTOS_ROW[1]/PRO_CATEGORIA = 'F' and not(/Analizar/ANALISIS/UTILIZAR_REFERENCIA_PROVEEDOR)">ocho</xsl:when>
					<xsl:otherwise>doce</xsl:otherwise>
					</xsl:choose>
				</xsl:attribute>

				<xsl:value-of select="document($doc)/translation/texts/item[@name='ud_basica']/node()"/>
			</th>

			<!-- precio ud base sin IVA -->
			<th class="cuatro">
				<xsl:copy-of select="document($doc)/translation/texts/item[@name='precio_s_iva']/node()"/>
			</th>

			<!-- precio ud base con IVA -->
			<th class="cuatro">
				<xsl:copy-of select="document($doc)/translation/texts/item[@name='precio_c_iva']/node()"/>
			</th>

			<!--flechas si precio ha bajado o subido solo para no asisa-->
			<th class="zerouno">&nbsp;</th>

			<!-- cantidad -->
			<th class="cinco">
				<xsl:value-of select="document($doc)/translation/texts/item[@name='unidades']/node()"/>
			</th>

			<!-- lote -->
			<th class="tres">
				<xsl:value-of select="document($doc)/translation/texts/item[@name='embalaje']/node()"/>
			</th>

			<!-- importe total linea sin iva-->
			<th class="ocho" align="right">
				<xsl:copy-of select="document($doc)/translation/texts/item[@name='importe_s_iva_2line']/node()"/>
			</th>

			<!-- importe total linea con iva-->
			<th class="ocho" align="right">
				<xsl:copy-of select="document($doc)/translation/texts/item[@name='importe_c_iva_2line']/node()"/>
			</th>

			<!-- seleccionado -->
			<th class="uno">
				<xsl:value-of select="document($doc)/translation/texts/item[@name='sel']/node()"/><br />
				<input type="checkbox" name="SOLO_SELECCIONADOS" value="1" onClick="mostrarSeleccionados(this);"/>
			</th>
		</tr>
	</thead>
	<!--fin de titulos-->

	<!-- Aqui se montan dinamicamente las lineas de productos para generar el pedido -->
	<tbody></tbody>

	<tfoot>
		<tr>
			<td colspan="11">&nbsp;</td>
		</tr>

	<!--form sumaTotal-->
	<form name="sumaTotal">
		<input type="hidden" name="sumaTotalBrasil"/>
		<input type="hidden" name="COSTE_LOGISTICA" value="0"/>

		<tr>
			<td class="textRight" colspan="9">&nbsp;</td>
			<!--si es espa�a-->
			<td class="textRight">
				<strong><xsl:value-of select="document($doc)/translation/texts/item[@name='total']/node()"/>:</strong>
			</td>
			<td class="textRight">
				<input type="text" class="noinput" name="sumaTotal" size="10" maxlength="12" style="text-align:right;" onFocus="this.blur();" value="0,00"/>
			</td>
			<td colspan="2">&nbsp;</td>
		</tr>
	</form>

		<tr>
			<td colspan="13">&nbsp;</td>
		</tr>

		<!-- Botones -->
		<tr>
			<td colspan="10">
			<!--solo para no asisa, no asisa = S => != N-->
			<xsl:if test="$OcultarPrecioReferencia!='N'">
				<span class="font11">&nbsp;<img src="http://www.newco.dev.br/images/order_d_verde.gif"/>&nbsp;<xsl:value-of select="document($doc)/translation/texts/item[@name='precio_producto_bajado_desde_ultimo_pedido']/node()"/>.</span><br />
				<span class="font11">&nbsp;<img src="http://www.newco.dev.br/images/order_a_rojo.gif"/>&nbsp;<xsl:value-of select="document($doc)/translation/texts/item[@name='precio_producto_subido_desde_ultimo_pedido']/node()"/>.</span>
			</xsl:if>
			</td>

			<td colspan="3">
			<xsl:choose>
			<xsl:when test="//ANALISIS/PEDIDO_MINIMO/IMPORTE != '0' and //ANALISIS/PEDIDO_MINIMO/IMPORTE != ''">
				<div class="boton" id="divContinuar">
					<a href="javascript:controlPedido(document.forms['formBot'],document.forms,'LPAnalizarSave.xsql',{//ANALISIS/PEDIDO_MINIMO/IMPORTE});" title="Continuar" id="botonContinuar"><xsl:value-of select="document($doc)/translation/texts/item[@name='continuar']/node()"/></a>
				</div>
			</xsl:when>
			<xsl:otherwise>
				<div class="boton" id="divContinuar">
					<a href="javascript:Actua(document.forms['formBot'],document.forms,'LPAnalizarSave.xsql');" title="Continuar" id="botonContinuar"><xsl:value-of select="document($doc)/translation/texts/item[@name='continuar']/node()"/></a>
				</div>
			</xsl:otherwise>
			</xsl:choose>
			</td>
		</tr>
	</tfoot>
	</table><!--fin de encuesta tabla-->
</xsl:template>


<!--NUEVO MODELO - NUEVO PEDIDO - PARA VIAMED VIEJO, VENDRELL... VEO PRECIO FINAL -->
<xsl:template name="nuevoModeloNuevoPedidoTablaProd">
<!--idioma-->
<xsl:variable name="lang">
	<xsl:choose>
	<xsl:when test="/Analizar/LANG"><xsl:value-of select="/Analizar/LANG"/></xsl:when>
	<xsl:otherwise>spanish</xsl:otherwise>
	</xsl:choose>
</xsl:variable>
<xsl:variable name="doc">http://www.newco.dev.br/General/texts_<xsl:value-of select="$lang"/>.xml</xsl:variable>
<!--idioma fin-->

<!--ocultar precio ref-->
<xsl:variable name="OcultarPrecioReferencia"><xsl:value-of select="/Analizar/ANALISIS/OCULTAR_PRECIO_REFERENCIA/@Ocultar"/></xsl:variable>

	<!--inicio tabla productos-->
	<table class="encuesta" border="0">
	<thead>
		<tr class="titulosNoAlto">
			<!-- ref mvm + provee -->
			<th class="ocho" align="left">
			<xsl:choose>
			<xsl:when test="LINEA_ROW/PRODUCTOS/PRODUCTOS_ROW[1]/PRO_CATEGORIA = 'F' and /Analizar/ANALISIS/UTILIZAR_REFERENCIA_PROVEEDOR">
				&nbsp;<xsl:value-of select="document($doc)/translation/texts/item[@name='codigo_nacional']/node()"/>
			</xsl:when>
			<xsl:otherwise>
				<xsl:value-of select="document($doc)/translation/texts/item[@name='ref_cliente']/node()"/>.
			</xsl:otherwise>
			</xsl:choose>
			</th>
                        <th class="dos">&nbsp;<!--image--></th>
			<!-- producto -->
			<th align="left">
				<xsl:value-of select="document($doc)/translation/texts/item[@name='producto']/node()"/>
				<span style="padding-left:5px;"><input type="text" name="strFiltro" id="strFiltro" size="20"/></span>
			</th>

			<!-- ref provee-->
			<th class="center">
				<xsl:attribute name="class">
					<xsl:choose>
					<!--si es farmacia no veo ref prov-->
					<xsl:when test="LINEA_ROW/PRODUCTOS/PRODUCTOS_ROW[1]/PRO_CATEGORIA = 'F'">zerouno</xsl:when>
					<xsl:when test="LINEA_ROW/PRODUCTOS/PRODUCTOS_ROW[1]/PRO_CATEGORIA = 'N'">ocho</xsl:when>
					</xsl:choose>
				</xsl:attribute>

			<xsl:choose>
			<!--si es farmacia no veo ref prov-->
			<xsl:when test="LINEA_ROW/PRODUCTOS/PRODUCTOS_ROW[1]/PRO_CATEGORIA = 'F'"></xsl:when>
			<xsl:when test="LINEA_ROW/PRODUCTOS/PRODUCTOS_ROW[1]/PRO_CATEGORIA = 'N'">
				<xsl:value-of select="document($doc)/translation/texts/item[@name='ref_prov']/node()"/>
			</xsl:when>
			</xsl:choose>
			</th>

			<!--marca-->
			<th>
				<xsl:attribute name="class">
					<xsl:choose>
					<xsl:when test="/Analizar/ANALISIS/SIN_MARCA">zerouno</xsl:when>
					<xsl:when test="LINEA_ROW/PRODUCTOS/PRODUCTOS_ROW[1]/PRO_CATEGORIA = 'F'">veinte</xsl:when>
					<xsl:when test="LINEA_ROW/PRODUCTOS/PRODUCTOS_ROW[1]/PRO_CATEGORIA = 'N'">ocho</xsl:when>
					</xsl:choose>
				</xsl:attribute>

			<xsl:choose>
			<xsl:when test="/Analizar/ANALISIS/SIN_MARCA"></xsl:when>
			<xsl:otherwise>
				<xsl:value-of select="document($doc)/translation/texts/item[@name='marca']/node()"/>
			</xsl:otherwise>
			</xsl:choose>
			</th>

			<!-- ud base -->
			<th>
				<xsl:attribute name="class">
					<xsl:choose>
					<!--si es farmacia y viamed5 mas estrecho-->
					<xsl:when test="LINEA_ROW/PRODUCTOS/PRODUCTOS_ROW[1]/PRO_CATEGORIA = 'F' and not(/Analizar/ANALISIS/UTILIZAR_REFERENCIA_PROVEEDOR)">ocho</xsl:when>
					<xsl:otherwise>doce</xsl:otherwise>
					</xsl:choose>
				</xsl:attribute>

				<xsl:value-of select="document($doc)/translation/texts/item[@name='ud_basica']/node()"/>
			</th>

			<!-- precio ud base con IVA -->
			<th class="cinco">
				<xsl:copy-of select="document($doc)/translation/texts/item[@name='precio_final_iva']/node()"/>
			</th>

			<!--flechas si precio ha bajado o subido -->
			<th class="zerouno">&nbsp;</th>

			<!-- cantidad -->
			<th class="cinco">
				<xsl:value-of select="document($doc)/translation/texts/item[@name='unidades']/node()"/>
			</th>

			<!-- lote -->
			<th class="tres">
				<xsl:value-of select="document($doc)/translation/texts/item[@name='embalaje']/node()"/>
			</th>

			<!-- importe total linea-->
			<th class="ocho" align="right">
				<xsl:copy-of select="document($doc)/translation/texts/item[@name='total']/node()"/>
			</th>

			<!-- seleccionado -->
			<th class="uno">
				<xsl:value-of select="document($doc)/translation/texts/item[@name='sel']/node()"/><br />
				<input type="checkbox" name="SOLO_SELECCIONADOS" value="1" onClick="mostrarSeleccionados(this);"/>
			</th>
		</tr>
	</thead>
	<!--fin de titulos-->

	<!-- Aqui se montan dinamicamente las lineas de productos para generar el pedido -->
	<tbody></tbody>

	<tfoot>
		<tr>
			<td colspan="11">&nbsp;</td>
		</tr>

	<!--form sumaTotal-->
	<form name="sumaTotal">
		<input type="hidden" name="sumaTotalBrasil"/>
		<input type="hidden" name="COSTE_LOGISTICA" value="0"/>

		<tr>
			<td class="textRight" colspan="6">&nbsp;</td>
			<!--si es espa�a-->
			<td class="textRight" colspan="2">
				<strong><xsl:value-of select="document($doc)/translation/texts/item[@name='total']/node()"/>:</strong>
			</td>
			<td class="textRight" colspan="2">
				<input type="text" class="noinput" name="sumaTotal" size="10" maxlength="12" style="text-align:right;" onFocus="this.blur();" value="0,00"/>
			</td>
			<td colspan="2">&nbsp;</td>
		</tr>
	</form>

		<tr>
			<td colspan="11">&nbsp;</td>
		</tr>

		<!-- Botones -->
		<tr>
			<td colspan="8">
			<xsl:if test="$OcultarPrecioReferencia='S'">
				<span class="font11">&nbsp;&nbsp;<xsl:value-of select="document($doc)/translation/texts/item[@name='comision_mvm_iva']/node()"/></span><br />
			</xsl:if>

			<!--solo para no asisa, no asisa = S => != N-->
			<xsl:if test="$OcultarPrecioReferencia!='N'">
				<span class="font11">&nbsp;<img src="http://www.newco.dev.br/images/order_d_verde.gif"/>&nbsp;<xsl:value-of select="document($doc)/translation/texts/item[@name='precio_producto_bajado_desde_ultimo_pedido']/node()"/>.</span><br />
				<span class="font11">&nbsp;<img src="http://www.newco.dev.br/images/order_a_rojo.gif"/>&nbsp;<xsl:value-of select="document($doc)/translation/texts/item[@name='precio_producto_subido_desde_ultimo_pedido']/node()"/>.</span>
			</xsl:if>
			</td>

			<td colspan="3">
			<xsl:choose>
			<xsl:when test="//ANALISIS/PEDIDO_MINIMO/IMPORTE != '0' and //ANALISIS/PEDIDO_MINIMO/IMPORTE != ''">
				<div class="boton" id="divContinuar">
					<a href="javascript:controlPedido(document.forms['formBot'],document.forms,'LPAnalizarSave.xsql',{//ANALISIS/PEDIDO_MINIMO/IMPORTE});" title="Continuar" id="botonContinuar"><xsl:value-of select="document($doc)/translation/texts/item[@name='continuar']/node()"/></a>
				</div>
			</xsl:when>
			<xsl:otherwise>
				<div class="boton" id="divContinuar">
					<a href="javascript:Actua(document.forms['formBot'],document.forms,'LPAnalizarSave.xsql');" title="Continuar" id="botonContinuar"><xsl:value-of select="document($doc)/translation/texts/item[@name='continuar']/node()"/></a>
				</div>
			</xsl:otherwise>
			</xsl:choose>
			</td>
		</tr>
	</tfoot>
	</table><!--fin de encuesta tabla-->


</xsl:template>

<!--
<xsl:template match="PROVEEDOR">
   <i><a class="suave">
    <xsl:attribute name="href">javascript:MostrarPagPersonalizada('http://www.newco.dev.br/Administracion/Mantenimiento/Empresas/EMPDetalleFrame.xsql?EMP_ID=<xsl:value-of select="../IDPROVEEDOR"/>&amp;VENTANA=NUEVA','empresa',100,80,0,0)</xsl:attribute>
    <xsl:attribute name="onMouseOver">window.status='Informaci�n sobre la empresa.';return true;</xsl:attribute>
    <xsl:attribute name="onMouseOut">window.status='';return true;</xsl:attribute>

    <xsl:value-of select="."/>
   </a></i>
</xsl:template>
-->

<!-- DC - 28may15 - Si se usa -->
<xsl:template name="hiddensPedido">
	<input type="hidden" name="SELECCIONTOTAL"/>
	<input type="hidden" name="LP_ID" value="{LP_ID}"/>
	<input type="hidden" name="STRING_CANTIDADES"/>
<!--	<input type="hidden" name="IDDIVISA" value="0"/>-->
<!--	<input type="hidden" name="LP_IDFORMAPAGO"/>-->
<!--	<input type="hidden" name="LP_IDPLAZOPAGO"/>-->
<!--	<input type="hidden" name="LP_FORMAPAGO"/>-->
</xsl:template>

<!-- DC - 28may15 - Si se usa -->
<xsl:template name="direccion">
<xsl:param name="path"/>

	<p class="textLeft">
		<input type="text" name="CEN_DIRECCION" size="50" value="{$path/CEN_DIRECCION}" style="text-align:left; margin-top:10px;" class="noinput" onFocus="this.blur();"/>
		<br />

	<!--spain-->
	<xsl:choose>
	<xsl:when test="/Analizar/ANALISIS/IDPAIS != '55'">
		<input type="text" name="CEN_CPOSTAL" size="4" value="{$path/CEN_CPOSTAL}" style="text-align:left;" class="noinput" onFocus="this.blur();"/>
	</xsl:when>
	<xsl:otherwise>
		<input type="text" name="CEN_CPOSTAL" size="10" value="{$path/CEN_CPOSTAL}" style="text-align:left;" class="noinput" onFocus="this.blur();"/>
	</xsl:otherwise>
	</xsl:choose>

		<xsl:text>-&nbsp;</xsl:text>
		<input type="text" name="CEN_POBLACION" size="20" value="{$path/CEN_POBLACION}" style="text-align:left;" class="noinput" onFocus="this.blur();"/>
		<input type="hidden" name="CEN_PROVINCIA" value="{$path/CEN_PROVINCIA}"/>
	</p>
</xsl:template>
<!-- fin templates de la nueva version -->
</xsl:stylesheet>
