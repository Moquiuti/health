<?xml version="1.0" encoding="iso-8859-1"?>
<!--
	Problemas con referencia SI-EXAMEN-SP-M
	Ultima revision: ET 28oct16
-->
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0">
<xsl:import href = "http://www.newco.dev.br/General/General.xsl"/>
<xsl:output media-type="text/html" method="html" encoding="iso-8859-1"/>
<xsl:param name="lang" select="@lang"/>

<xsl:template match="/">

<html>
<head>
	<!--idioma-->
	<xsl:variable name="lang">
		<xsl:choose>
		<xsl:when test="/MantenimientoPedidos/LANG"><xsl:value-of select="/MantenimientoPedidos/LANG"/></xsl:when>
		<xsl:otherwise>spanish</xsl:otherwise>
		</xsl:choose>
	</xsl:variable>
	<xsl:variable name="doc">http://www.newco.dev.br/General/texts_<xsl:value-of select="$lang"/>.xml</xsl:variable>
	<!--idioma fin-->

	<!--style-->
	<xsl:call-template name="estiloIndip"/>
	<!--fin de style-->

	<script type="text/javascript" src="http://www.newco.dev.br/General/jquery.js"></script>
	<script type="text/javascript" src="http://www.newco.dev.br/General/ajax.js"></script>
	<script type="text/javascript" src="http://www.newco.dev.br/General/basic_180608.js"></script>

	<title><xsl:value-of select="document($doc)/translation/texts/item[@name='mantenimiento_pedidos']/node()"/></title>

	<script type="text/javascript">var motivo_borrar_obligatorio = '<xsl:value-of select="document($doc)/translation/texts/item[@name='motivo_borrar_obl']/node()"/>';</script>

	<xsl:text disable-output-escaping="yes"><![CDATA[
	<script type="text/javascript">
	<!--
		function Enviar(Accion){
			var form=document.forms['form1'];
			var jsForm=document.forms['MensajeJS'];
			var MsgError='';
			var motivo	= jQuery('#MOTIVO_BORRAR').val();
			//	Validar datos introducidos
			if(form.elements['IDCLIENTE'].value =='-1')
				MsgError=MsgError + jsForm.elements['CLIENTE_OBLI'].value +'\n';
			if(form.elements['IDPROVEEDOR'].value =='-1')
				MsgError=MsgError + jsForm.elements['PROVEEDOR_OBLI'].value +'\n';
			if(form.elements['MO_ID'].value =='')
				MsgError=MsgError + jsForm.elements['MO_ID_OBLI'].value +'\n';
			// Validacion textarea 'MOTIVO_BORRAR'
			if(motivo == '' && Accion == 'BORRAR'){
				MsgError = MsgError + motivo_borrar_obligatorio;
				jQuery('#MOTIVO_BORRAR').focus();
			}else if(MsgError == '')
				form.elements['PARAMETROS'].value = motivo;
			if( MsgError!=''){
				alert(MsgError);
			}else{
				//	Realizar accion
				form.elements['ACCION'].value=Accion;
				SubmitForm(form);
			}
		}

		function ComprobarPedido(){
			Enviar('COMPROBAR');
		}

		function BorrarPedido(){
			Enviar('BORRAR');
		}

		function PedidoPendienteDeRecepcion(form){
                        var mo_id = form.elements['MO_ID'].value;
                        var cliente = form.elements['IDCLIENTE'].value;
                        var provee = form.elements['IDPROVEEDOR'].value;
                        form.action = 'http://www.newco.dev.br/Administracion/Mantenimiento/Pedidos/MANTPedidosSave.xsql?MO_ID='+mo_id+'&IDCLIENTE='+cliente+'&IDPROVEEDOR='+provee;
			Enviar('CAMBIAR_ESTADO');
		}

		//	ACTUALIZAMOS DATOS PEDIDO 27-04-12 MC
		function Actualizar(accion,lmo,lpe){
			var form=document.forms['form1'];
			var jsForm=document.forms['MensajeJS'];
                        
                        //	si cambia el IVA del pedido 8-1-15
			if(accion == 'ACTUALIZARIVA'){
					form.elements['ACCION'].value=accion;
					SubmitForm(form);
			}
            
			//	si cambia el num pedido
			if(accion == 'NUMERO_PEDIDO'){
				//	si num pedido no esta vacio
				if(document.forms['form1'].elements['NUM_PEDIDO'].value != ''){
					form.elements['PARAMETROS'].value=form.elements['NUM_PEDIDO'].value;
					form.elements['ACCION'].value=accion;

					SubmitForm(form);
				}else{
					alert(document.forms['MensajeJS'].elements['OBLI_NUM_PEDIDO'].value+'\n');
				}
			}

			//	si elimino una linea del pedido
			if(accion == 'BORRAR_LINEA'){
				if(!confirm(jsForm.elements['SEGURO_ELIMINAR_LINEA_PEDIDO'].value)) { }
				else{
					form.elements['PARAMETROS'].value= lpe+'|'+lmo;
					form.elements['ACCION'].value=accion;

					SubmitForm(form);
				}
			}

			//	si cambia la fecha de entrega
			if(accion == 'FECHA_ENTREGA'){
				msg=CheckDate(document.forms['form1'].elements['FECHA_ENTREGA'].value);

				//	si fecha no esta vacia
				if(document.forms['form1'].elements['FECHA_ENTREGA'].value != ''){
					if(msg!=''){
						alert(msg);
					}else{
						form.elements['PARAMETROS'].value=document.forms['form1'].elements['FECHA_ENTREGA'].value;
						form.elements['ACCION'].value=accion;

						SubmitForm(form);
					}
				}

				//	si fecha vacia alert
				else{alert(jsForm.elements['OBLI_FECHA_ENTREGA'].value+'\n');}
			}

			//	si cambia una linea de pedido
			if(accion == 'CAMBIAR_LINEA'){

				var mess= '';
				var udBasica = form.elements['UN_BASICA_'+lmo].value;
				var udLote = form.elements['UN_LOTE_'+lmo].value;
				var cantidad = form.elements['CANTIDAD_'+lmo].value;
				var precioUn = form.elements['PRECIO_'+lmo].value;
				var precioRef;

				if(form.elements['PRECIOREF_'+lmo] && form.elements['PRECIOREF_'+lmo].value!='')
					precioRef = form.elements['PRECIOREF_'+lmo].value;
				else
					precioRef = '';

				//	si algun campo vacio
				if(udBasica == '' || udLote == '' || cantidad == '' || precioUn == ''){
					if(udBasica == ''){ mess = mess + document.forms['MensajeJS'].elements['OBLI_UD_BASE'].value+'\n'; }
					if(udLote == ''){ mess = mess + document.forms['MensajeJS'].elements['OBLI_UD_LOTE'].value+'\n'; }
					if(cantidad == ''){ mess = mess + document.forms['MensajeJS'].elements['OBLI_CANTIDAD'].value+'\n'; }
					if(precioUn == ''){ mess = mess + document.forms['MensajeJS'].elements['OBLI_PRECIO'].value+'\n'; }

					alert(mess);
				}

				//	si todos campos informados
				else{
					if(precioRef <= precioUn && precioRef != ''){
						if(!confirm(document.forms['MensajeJS'].elements['PRECIO_REF_INFERIOR'].value))
							return;
					}

					form.elements['PARAMETROS'].value= lpe+'|'+lmo+'|'+udBasica+'|'+udLote+'|'+cantidad+'|'+precioUn+'|'+precioRef;
					form.elements['ACCION'].value=accion;

					SubmitForm(form);
				}
			}

			//	si añado una linea al pedido
			if(accion == 'NUEVA_LINEA'){
				var msg = '';
				var cantidad = document.forms['form1'].elements['NEWLINE_CANTIDAD'].value;
				var refProv = document.forms['form1'].elements['NEWLINE_REFPROV'].value;
                var unLote = document.forms['form1'].elements['UN_LOTE_DATOS_PROD'].value;
                var idProd = document.forms['form1'].elements['ID_PROD'].value;

				//	comprobamos que no esten vacios
				if(cantidad == '' || cantidad == '0'){ msg += jsForm.elements['OBLI_CANTIDAD'].value +'\n'; }
				if(refProv == ''){ msg += jsForm.elements['OBLI_REF_PROVE'].value +'\n';}

				//	si not a number = true implica que no es un numero
				if(isNaN(cantidad) == true){ msg += jsForm.elements['NOT_A_NUMBER'].value +'\n';}
				
                //compruebo que la cantidad pedida es correcta respecto a la unidad lote
                if (cantidad % unLote != 0){ msg += jsForm.elements['CANTIDAD_INCORRECTA'].value +'\n';}
                
                //alert('mi'+cantidad % unLote);
				
				//	compruebo que la ref proveedor del producto no este ya en el pedido
				jQuery(".refProveedores").each(function(){
					if(refProv == jQuery(this).html()){
						msg += jsForm.elements['PRODUCTO_EXISTE_PEDIDO'].value +'\n';
					}
				});
                //	compruebo que la ref privada del producto no este ya en el pedido
				jQuery(".refPrivada").each(function(){
					if(refProv == jQuery(this).html()){
						msg += jsForm.elements['PRODUCTO_EXISTE_PEDIDO'].value +'\n';
					}
				});
				
				if(msg == ''){
					form.elements['PARAMETROS'].value= ' '+'|'+' '+'|'+' '+'|'+ ' ' +'|'+cantidad+'|'+' '+'|'+idProd;;
					form.elements['ACCION'].value=accion;

					SubmitForm(form);
				}else{ alert(msg);}
                
			}//fin if nueva linea
		}//fin de actualizar
        

		function Ocultar(IDLineaPedido, Oculto){
			var form=document.forms['form1'];
			form.elements['IDLINEAPEDIDO'].value=IDLineaPedido;
			form.elements['OCULTAR'].value=Oculto;

			SubmitForm(form);
		}
	
    //function recuperar datos de un producto para añadir linea pedido
	function DatosProducto(){
		var form = document.forms['form1'];
		var jsForm = document.forms['MensajeJS'];
		var msg = '';

		var moId	= form.elements['MOID'].value;
		var refProd	= encodeURIComponent(form.elements['NEWLINE_REFPROV'].value);
	
		if(refProd != '' && moId != ''){
			jQuery.ajax({
				cache:	false,
				url:	'http://www.newco.dev.br/Administracion/Mantenimiento/Pedidos/DatosProducto.xsql',
				type:	"GET",
				data:	"MOID="+moId+"&REF_PROD="+refProd,
				contentType: "application/xhtml+xml",
				error: function(objeto, quepaso, otroobj){
					alert('error'+quepaso+' '+otroobj+''+objeto);
				},
				success: function(objeto){
					var data = eval("(" + objeto + ")");
                    //alert(data.DatosProducto.REF);
					
					if (data.DatosProducto.PRO_NOMBRE!='')		//	28oct16	Control errores
					{

                    	txtHTML = "<td>"+" "+"</td>" + 
                    					"<td class='datosLeft'>" + data.DatosProducto.REF_PRIVADA+"</td>" +
										"<td class='datosLeft'>" + data.DatosProducto.REF+"</td>" +
										"<td class='datosLeft'>" + data.DatosProducto.PRO_NOMBRE+"</td>" +
										"<td class='datosLeft'>" + data.DatosProducto.UN_BASICA+"</td>" +
                                    	"<td class='datosLeft'><input type='text' name='UN_LOTE_DATOS_PROD' id='UN_LOTE_DATOS_PROD' size='10' value='" + data.DatosProducto.UN_LOTE+"' class='noinput' /></td>" +
                                    	"<td class='datosLeft'><input type='text' name='NEWLINE_CANTIDAD' id='NEWLINE_CANTIDAD' size='10' value='" + data.DatosProducto.UN_LOTE+"'/></td>" +
                                    	"<td class='datosLeft'>" + data.DatosProducto.TARIFA+"</td>" +
                                    	"<td>"+"<div class='boton'><a href='javascript:Actualizar(\"NUEVA_LINEA\");'>"+jsForm.elements['ENVIAR'].value+"</a></div>"+"</td>"+
                                    	"<td class='datosLeft'><input type='text' name='ID_PROD' id='ID_PROD' size='10' value='" + data.DatosProducto.PRO_ID+"'  style='display:none;' /></td>" +
                                    	"<td colspan='3'> </td>";

                	   //escribo HTML en la linea
                    	jQuery("#datosProd").empty();
						jQuery("#datosProd").show();
						jQuery("#datosProd").append(txtHTML);
					}
					else
					{
						alert('No se ha encontrado el producto.');		//PENDIENTE TRADUCIR MENSAJE
                    	jQuery("#datosProd").hide();
					}
				   
				}
			});//fin jquery
		}else{
			msg = jsForm.elements['TODOS_CAMPOS_OBLI'].value;
			alert(msg);
		}
	}//fin de RECUPERAR DATOS LINEA PRODUCTO
    
    
	//ver div de productos manuales, revision 11-10-2013 MC funcionante
	function VerProductosManuales(){
		if(document.getElementById('InsertarProductosManuales').style.display == 'none'){
			//jQuery("#divProductosManuales").show();
			jQuery("#InsertarProductosManuales").show();
		}else{
			if(document.getElementById('InsertarProductosManuales').style.display != 'none'){
				//jQuery("#divProductosManuales").hide();
				jQuery("#InsertarProductosManuales").hide();
			}
		}
	}

	//function añadir productos no en plantilla
	function AnadirProductosManuales(){
		var form = document.forms['form1'];
		var jsForm = document.forms['MensajeJS'];
		var msg = '';

		var moId	= form.elements['MOID'].value;
		var refProv	= encodeURIComponent(form.elements['REFPROVEEDOR'].value);
		var descripcion	= encodeURIComponent(form.elements['DESCRIPCION'].value);
		var unBasica	= encodeURIComponent(form.elements['UNIDADBASICA'].value);
		var cantidad	= form.elements['CANTIDAD'].value;
		//var precio	= form.elements['PRECIOUNITARIO'].value;
		//var iva	= form.elements['TIPO_IVA'].value;

		if(refProv != '' && descripcion != '' && unBasica != '' && cantidad != ''){
			jQuery.ajax({
				cache:	false,
				url:	'http://www.newco.dev.br/Compras/Multioferta/ProductosManualesSave_ajax.xsql',
				type:	"GET",
				data:	"MOID="+moId+"&REFPROVEEDOR="+refProv+"&DESCRIPCION="+descripcion+"&UNIDADBASICA="+unBasica+"&CANTIDAD="+cantidad,
				contentType: "application/xhtml+xml",
				error: function(objeto, quepaso, otroobj){
					alert('error'+quepaso+' '+otroobj+''+objeto);
				},
				success: function(objeto){
					var data = eval("(" + objeto + ")");

					if(data.ProductosManualesSave.estado == 'OK'){
						RecuperaProductosManuales(moId);
						form.elements['REFPROVEEDOR'].value = '';
						form.elements['DESCRIPCION'].value = '';
						form.elements['UNIDADBASICA'].value = '';
						form.elements['CANTIDAD'].value = '';
						//form.elements['PRECIOUNITARIO'].value = '';
						//form.elements['TIPO_IVA'].value = '';
						//document.location.reload(true);
					}else{
						alert(jsForm.elements['ERROR_INSERTAR_DATOS'].value);
					}
				}
			});//fin jquery
		}else{
			msg = jsForm.elements['TODOS_CAMPOS_OBLI'].value;
			alert(msg);
		}
	}//fin de AnadirProductosManuales

	//function eliminar productos manuales
     		 function EliminarProductosManuales(idProdMan){
     			var form = document.forms['form1'];
                var jsForm = document.forms['MensajeJS'];
                
            	var msg = '';
            	var moId= form.elements['MOID'].value;
                
                if (idProdMan != ''){
                
                    jQuery.ajax({
                    cache:	false,
                    url:	'http://www.newco.dev.br/Compras/Multioferta/EliminarProductosManuales.xsql',
                    type:	"GET",
                    data:	"ID_PRODMAN="+idProdMan,
                    contentType: "application/xhtml+xml",
                    error: function(objeto, quepaso, otroobj){
                        alert('error'+quepaso+' '+otroobj+''+objeto);
                    },
                    success: function(objeto){
                        var data = eval("(" + objeto + ")");
            
                        if(data.EliminarProductosManuales.estado == 'OK'){
                        	RecuperaProductosManuales(moId);
                        }else{
                            alert(jsForm.elements['ERROR_ELIMINAR_DATOS'].value);
                        }
                    }
                    });//fin jquery
            	}
                else{ 
                    msg = jsForm.elements['ERROR_ELIMINAR_DATOS'].value; 
                    alert(msg);
                }
            }//fin de EliminarProductosManuales
     
     
            //recupero a los productos manuales
            function RecuperaProductosManuales(moId){
                
                var ACTION="http://www.newco.dev.br/Compras/Multioferta/ProductosManuales.xsql";
                var post='MOID='+moId;
                if (moId != '') sendRequest(ACTION,handleRequestProductosManuales,post);
            }
     
            //recupero a los productos manuales
            function RecuperaProductosManuales(moId){
                
                var ACTION="http://www.newco.dev.br/Compras/Multioferta/ProductosManuales.xsql";
                var post='MOID='+moId;
                if (moId != '') sendRequest(ACTION,handleRequestProductosManuales,post);
            }
            
          function handleRequestProductosManuales(req){
                
                var response = eval("(" + req.responseText + ")");
                var Resultados = new String('');
                
                if(response.ProductosManuales.length > 0){
                	jQuery("#divProductosManuales").show();
                    
					jQuery("#productosManuales tbody").empty();
                
					// Se crea la tabla de los productos manuales
					jQuery.each(response.ProductosManuales, function(key, producto){

						txtHTML = "<tr id="+producto.PMId+">" +
									"<td>" + producto.PMRefProv+"</td>" +
									"<td>" + producto.PMDescripcion+"</td>" +
									"<td>" + producto.PMUnBasica+"</td>" +
									"<td>" + producto.PMCantidad+"</td>" +
                                    //"<td align='center'>" + producto.PMPrecio+"</td>" +
                                    //"<td align='center'>" + producto.PMIva+"</td>" +
									"<td>" +
										"<a class=\"accBorrar\" href=\"javascript:EliminarProductosManuales('"+producto.PMId+"');\">" +
											"<img src='http://www.newco.dev.br/images/borrar.gif'/>" +
										"</a>" +
        	                        "</td>" +
                                    "<td>"+" "+"</td>" +
								"</tr>";
                    
					//escribo HTML en la tabla
					jQuery("#productosManuales").show();
					jQuery("#productosManuales tbody").append(txtHTML);
                    });
				
				}
                //si no hay productos
                else{
                	jQuery("#productosManuales tbody").empty();
                    jQuery("#productosManuales").hide();
                
                }
            }//fin de recupero productos manuales
            
            function GenerarPDF(){
            	var form=document.forms['form1'];
                var jsForm=document.forms['MensajeJS'];
            	var mo_id = form.elements['MO_ID'].value;
                
                //alert('mi '+mo_id);
            	jQuery.ajax({
                    cache:	false,
                    url:	'http://www.newco.dev.br/Administracion/Mantenimiento/Pedidos/RecargarPDF.xsql',
                    type:	"GET",
                    data:	"MO_ID="+mo_id,
                    contentType: "application/xhtml+xml",
                    success: function(objeto){
                        var data = eval("(" + objeto + ")");
        
                        if(data.RecargarPDF.estado == 'OK'){
                            alert(jsForm.elements['PDF_ENVIADO_CON_EXITO'].value);
                            //jQuery("#"+modificarFechaLimite).show();
                           
                        }
                    },
                    error: function(xhr, errorString, exception) {
                        alert("xhr.status="+xhr.status+" error="+errorString+" exception="+exception);
                    }
                });
            }//fin de generarPDF
            
            function VerPedido(mo_id){
                  	window.open('http://www.newco.dev.br/Compras/Multioferta/MultiofertaFrame.xsql?MO_ID='+mo_id, '_self');
                  }//fin verPedido
            
	-->
	</script>
	]]></xsl:text>
</head>
<body class="gris">
	<xsl:attribute name="onload">
    <xsl:if test="/MantenimientoPedidos/MO_ID != '' and /MantenimientoPedidos/IDCLIENTE != '' and /MantenimientoPedidos/IDPROVE != ''">ComprobarPedido();</xsl:if>
    </xsl:attribute>

	<!--idioma-->
	<xsl:variable name="lang">
		<xsl:choose>
		<xsl:when test="/MantenimientoPedidos/LANG"><xsl:value-of select="/MantenimientoPedidos/LANG" /></xsl:when>
		<xsl:otherwise>spanish</xsl:otherwise>
		</xsl:choose>
	</xsl:variable>
	<xsl:variable name="doc">http://www.newco.dev.br/General/texts_<xsl:value-of select="$lang"/>.xml</xsl:variable>
	<!--idioma fin-->

	<form action="MANTPedidosSave.xsql" method="POST" name="form1">
		<input type="hidden" id="ACCION" name="ACCION"/>
		<input type="hidden" id="PARAMETROS" name="PARAMETROS"/>
		<input type="hidden" name="IDLINEAPEDIDO"/>
		<input type="hidden" name="OCULTAR"/>

	<xsl:choose>
	<!-- ET Desactivado control errores: Habra que reactivarlo -->
	<xsl:when test="MantenimientoPedidos/xsql-error">
		<xsl:apply-templates select="Noticias/xsql-error"/>
	</xsl:when>
	<xsl:when test="MantenimientoPedidos/ROW/Sorry">
		<xsl:apply-templates select="Noticias/ROW/Sorry"/>
	</xsl:when>
	<xsl:otherwise>
		<xsl:value-of select="@TIPO"/>

 		<!--	Titulo de la página		-->
		<div class="ZonaTituloPagina">
			<p class="Path"><xsl:value-of select="document($doc)/translation/texts/item[@name='Inicio']/node()"/>&nbsp;/&nbsp;<span class="FinPath"><xsl:value-of select="document($doc)/translation/texts/item[@name='mantenimiento_pedidos']/node()"/></span>
				<span class="CompletarTitulo" style="width:700px;">
 					<xsl:value-of select="/MantenimientoPedidos/MANTENIMIENTO/LISTAEMPRESAS/PEDIDO/PED_NUMEROCLINICA"/>&nbsp;
					<xsl:for-each select="/MantenimientoPedidos/MANTENIMIENTO/LISTAEMPRESAS/CLIENTE/field/dropDownList/listElem">
						<xsl:if test="../../@current = ID">
							<xsl:value-of select="listItem"/>
							<input type="hidden" name="IDCLIENTE" id="IDCLIENTE" value="{ID}"/>
						</xsl:if>
					</xsl:for-each>:
					&nbsp;
					<xsl:for-each select="/MantenimientoPedidos/MANTENIMIENTO/LISTAEMPRESAS/PROVEEDOR/field/dropDownList/listElem">
						<xsl:if test="../../@current = ID">
							<xsl:value-of select="listItem"/>
							<input type="hidden" name="IDPROVEEDOR" id="IDPROVEEDOR" value="{ID}"/>
						</xsl:if>
					</xsl:for-each>
                	<xsl:if test="/MantenimientoPedidos/MANTENIMIENTO/ESTADO and /MantenimientoPedidos/MANTENIMIENTO/ESTADO != 'OK'">
                    	&nbsp;&nbsp;<span style="background-color:yellow;"><xsl:value-of select="MantenimientoPedidos/MANTENIMIENTO/ESTADO"/></span>
                	</xsl:if>				
				</span>
			</p>
			<p class="TituloPagina">
 				<xsl:value-of select="/MantenimientoPedidos/MANTENIMIENTO/LISTAEMPRESAS/PEDIDO/PED_NUMEROCLINICA"/>&nbsp;
				<xsl:for-each select="/MantenimientoPedidos/MANTENIMIENTO/LISTAEMPRESAS/CLIENTE/field/dropDownList/listElem">
					<xsl:if test="../../@current = ID">
						<xsl:value-of select="listItem"/>
						<input type="hidden" name="IDCLIENTE" id="IDCLIENTE" value="{ID}"/>
					</xsl:if>
				</xsl:for-each>
				<span class="CompletarTitulo" style="width:700px;">
					<xsl:if test="/MantenimientoPedidos/MANTENIMIENTO/LISTAEMPRESAS/PEDIDO/PED_ID">
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
						<a class="btnNormal">
            			<xsl:attribute name="href">javascript:VerPedido('<xsl:value-of select="/MantenimientoPedidos/MANTENIMIENTO/MO_ID"/>');</xsl:attribute>
            			<xsl:value-of select="document($doc)/translation/texts/item[@name='ver_pedido']/node()"/>&nbsp;</a>
						&nbsp;
						<a class="btnDestacado" href="javascript:BorrarPedido();">&nbsp;<xsl:value-of select="document($doc)/translation/texts/item[@name='borrar_pedido']/node()"/>&nbsp;</a>
						&nbsp;
            			<!--si es un pedido rechazado (que no tiene lineas de pedido) no retrocedemos si no fallan los datos 9-9-15 mc-->
            			<xsl:if test="/MantenimientoPedidos/MANTENIMIENTO/LISTAEMPRESAS/PEDIDO/LINEASPEDIDO/LINEAPEDIDO">
							<a class="btnDestacado" href="javascript:PedidoPendienteDeRecepcion(document.forms['form1']);">&nbsp;<xsl:value-of select="document($doc)/translation/texts/item[@name='pendiente_recepcion']/node()"/>&nbsp;</a>
						&nbsp;
            			</xsl:if>
						<a class="btnDestacado" href="javascript:GenerarPDF();"><xsl:value-of select="document($doc)/translation/texts/item[@name='generar_pdf']/node()"/></a>
						&nbsp;
            			<xsl:if test="MantenimientoPedidos/LANG = 'spanish'">
							<a class="btnDestacado" href="javascript:Actualizar('ACTUALIZARIVA');"><xsl:value-of select="document($doc)/translation/texts/item[@name='actualizar_iva']/node()"/></a>
            			</xsl:if>
					</xsl:if>
				</span>
			</p>
       </div>
	   <br/>


	<!--

		<h1 class="titlePage"><xsl:value-of select="document($doc)/translation/texts/item[@name='mantenimiento_pedidos']/node()"/>
                    <xsl:if test="/MantenimientoPedidos/MANTENIMIENTO/ESTADO and /MantenimientoPedidos/MANTENIMIENTO/ESTADO != 'OK'">
                        &nbsp;&nbsp;<span style="background-color:yellow;"><xsl:value-of select="MantenimientoPedidos/MANTENIMIENTO/ESTADO"/></span>
                    </xsl:if>
                </h1>-->
        
		<div class="divLeft">
			<table class="buscador">
<!--
			<thead>
				<tr class="subTituloTabla">
					<td colspan="2"> <xsl:value-of select="document($doc)/translation/texts/item[@name='introducir_datos_pedido']/node()"/></td>
				</tr>
			</thead>-->
			<tbody>
				<tr class="sinLinea"><td colspan="2">&nbsp;</td></tr>
				<tr class="sinLinea">
					<td class="labelRight cuarentacinco">&nbsp;&nbsp;<xsl:value-of select="document($doc)/translation/texts/item[@name='cliente']/node()"/>:&nbsp;</td>
					<td class="datosLeft">
						<xsl:for-each select="/MantenimientoPedidos/MANTENIMIENTO/LISTAEMPRESAS/CLIENTE/field/dropDownList/listElem">
							<xsl:if test="../../@current = ID">
								<xsl:value-of select="listItem"/>
								<input type="hidden" name="IDCLIENTE" id="IDCLIENTE" value="{ID}"/>
							</xsl:if>
						</xsl:for-each>
<!--
						<xsl:call-template name="desplegable">
							<xsl:with-param name="path" select="/MantenimientoPedidos/MANTENIMIENTO/LISTAEMPRESAS/CLIENTE/field"/>
							<xsl:with-param name="defecto" select="/MantenimientoPedidos/IDCLIENTE"/>
							<xsl:with-param name="deshabilitado">1</xsl:with-param>
						</xsl:call-template>
-->
					</td>
				</tr>
				<tr class="sinLinea">
					<td class="labelRight">&nbsp;&nbsp;<xsl:value-of select="document($doc)/translation/texts/item[@name='proveedor']/node()"/>:&nbsp;</td>
					<td class="datosLeft">
						<xsl:for-each select="/MantenimientoPedidos/MANTENIMIENTO/LISTAEMPRESAS/PROVEEDOR/field/dropDownList/listElem">
							<xsl:if test="../../@current = ID">
								<xsl:value-of select="listItem"/>
								<input type="hidden" name="IDPROVEEDOR" id="IDPROVEEDOR" value="{ID}"/>
							</xsl:if>
						</xsl:for-each>
<!--
						<xsl:call-template name="desplegable">
							<xsl:with-param name="path" select="/MantenimientoPedidos/MANTENIMIENTO/LISTAEMPRESAS/PROVEEDOR/field"/>
							<xsl:with-param name="defecto" select="/MantenimientoPedidos/IDPROVE"/>
							<xsl:with-param name="deshabilitado">1</xsl:with-param>
						</xsl:call-template>
-->
					</td>
				</tr>
				<!--
			<xsl:choose>
			<xsl:when test="/MantenimientoPedidos/MANTENIMIENTO/LISTAEMPRESAS/MANTENIMIENTO_AVANZADO">
				<tr class="sinLinea">
					<td class="labelRight">&nbsp;&nbsp;<xsl:value-of select="document($doc)/translation/texts/item[@name='mo_id']/node()"/>:&nbsp;</td>
					<td class="datosLeft">
						<input type="text" id="MO_ID" name="MO_ID" maxlength="10" size="10">
                        	<xsl:attribute name="value">
                            <xsl:choose>
                            <xsl:when test="/MantenimientoPedidos/MO_ID != ''"><xsl:value-of select="/MantenimientoPedidos/MO_ID" /></xsl:when>
                            <xsl:otherwise><xsl:value-of select="/MantenimientoPedidos/MANTENIMIENTO/MO_ID" /></xsl:otherwise>
                            </xsl:choose>
							</xsl:attribute>
						</input>&nbsp;&nbsp;

						<xsl:choose>
						<xsl:when test="/MantenimientoPedidos/MANTENIMIENTO/ESTADO='MO_ID_INCORRECTO'">
							<xsl:value-of select="document($doc)/translation/texts/item[@name='identificacion_pedido_no_se_corresponde']/node()"/>
						</xsl:when>
<!- - DC - 24abr14 - Ya no es necesario el texto "Identificación del pedido correcta" ya que siempre será correcta
						<xsl:when test="/MantenimientoPedidos/MANTENIMIENTO/ESTADO='OK'">
							<xsl:value-of select="document($doc)/translation/texts/item[@name='identificacion_pedido_correcta']/node()"/>
						</xsl:when>
- ->
						<xsl:when test="/MantenimientoPedidos/MANTENIMIENTO/ESTADO='BORRADO'">
							<xsl:value-of select="document($doc)/translation/texts/item[@name='pedido_borrado']/node()"/>
						</xsl:when>
						<xsl:when test="/MantenimientoPedidos/MANTENIMIENTO/ESTADO='PENDIENTE'">
							<xsl:value-of select="document($doc)/translation/texts/item[@name='pedido_modificado']/node()"/>
						</xsl:when>
						<xsl:when test="/MantenimientoPedidos/MANTENIMIENTO/ESTADO='TODAVIA_NO_PENDIENTE'">
							<xsl:value-of select="document($doc)/translation/texts/item[@name='pedido_no_se_ha_podido_modificar']/node()"/>
						</xsl:when>
						<xsl:when test="/MantenimientoPedidos/MANTENIMIENTO/ESTADO='SIN_DERECHOS'">
							<xsl:value-of select="document($doc)/translation/texts/item[@name='no_tiene_derechos_suficientes']/node()"/>
						</xsl:when>
						<xsl:otherwise></xsl:otherwise>
						</xsl:choose>
					</td>
				</tr>
			</xsl:when>
			<xsl:otherwise>
				<tr class="sinLinea">
					<td class="labelRight">&nbsp;&nbsp;<xsl:value-of select="document($doc)/translation/texts/item[@name='numero']/node()"/>:</td>
					<td class="datosLeft">
						<xsl:value-of select="/MantenimientoPedidos/MANTENIMIENTO/LISTAEMPRESAS/PEDIDO/MO_NUMEROCLINICA"/>
						<input type="hidden" id="MO_ID" name="MO_ID">
							<xsl:attribute name="value">
								<xsl:choose>
								<xsl:when test="/MantenimientoPedidos/MO_ID != ''"><xsl:value-of select="/MantenimientoPedidos/MO_ID"/></xsl:when>
								<xsl:otherwise><xsl:value-of select="/MantenimientoPedidos/MANTENIMIENTO/MO_ID"/></xsl:otherwise>
								</xsl:choose>
							</xsl:attribute>
						</input>
						&nbsp;&nbsp;

						<xsl:choose>
						<xsl:when test="/MantenimientoPedidos/MANTENIMIENTO/ESTADO='MO_ID_INCORRECTO'">
							<xsl:value-of select="document($doc)/translation/texts/item[@name='identificacion_pedido_no_se_corresponde']/node()"/>
						</xsl:when>
<!- - DC - 24abr14 - Ya no es necesario el texto "Identificación del pedido correcta" ya que siempre será correcta
						<xsl:when test="/MantenimientoPedidos/MANTENIMIENTO/ESTADO='OK'">
							<xsl:value-of select="document($doc)/translation/texts/item[@name='identificacion_pedido_correcta']/node()"/>
						</xsl:when>
- ->
						<xsl:when test="/MantenimientoPedidos/MANTENIMIENTO/ESTADO='BORRADO'">
							<xsl:value-of select="document($doc)/translation/texts/item[@name='pedido_borrado']/node()"/>
						</xsl:when>
						<xsl:when test="/MantenimientoPedidos/MANTENIMIENTO/ESTADO='PENDIENTE'">
							<xsl:value-of select="document($doc)/translation/texts/item[@name='pedido_modificado']/node()"/>
						</xsl:when>
						<xsl:when test="/MantenimientoPedidos/MANTENIMIENTO/ESTADO='TODAVIA_NO_PENDIENTE'">
							<xsl:value-of select="document($doc)/translation/texts/item[@name='pedido_no_se_ha_podido_modificar']/node()"/>
						</xsl:when>
						<xsl:when test="/MantenimientoPedidos/MANTENIMIENTO/ESTADO='SIN_DERECHOS'">
							<xsl:value-of select="document($doc)/translation/texts/item[@name='no_tiene_derechos_suficientes']/node()"/>
						</xsl:when>
						<xsl:otherwise></xsl:otherwise>
						</xsl:choose>
					</td>
				</tr>
				</xsl:otherwise>
				</xsl:choose>
				-->
				<input type="hidden" id="MO_ID" name="MO_ID">
					<xsl:attribute name="value">
						<xsl:choose>
						<xsl:when test="/MantenimientoPedidos/MO_ID != ''"><xsl:value-of select="/MantenimientoPedidos/MO_ID"/></xsl:when>
						<xsl:otherwise><xsl:value-of select="/MantenimientoPedidos/MANTENIMIENTO/MO_ID"/></xsl:otherwise>
						</xsl:choose>
					</xsl:attribute>
				</input>
				<!--<tr><td colspan="2">&nbsp;</td></tr>-->
			</tbody>
			</table>
			<!--<br /><br />-->

		<!--buttons-->
		<xsl:choose>
		<xsl:when test="/MantenimientoPedidos/MANTENIMIENTO/ESTADO='OK' or /MantenimientoPedidos/MANTENIMIENTO/ESTADO='ACTUALIZADO'">
			<div class="divLeft">

			<!-- Si NO es un pedido programado -->
			<xsl:if test="/MantenimientoPedidos/MANTENIMIENTO/LISTAEMPRESAS/PEDIDO/PED_ID">
				<table class="buscador" border="0">
<!--
					<tr>
						<td class="labelRight cuarentacinco">&nbsp;&nbsp;<xsl:value-of select="document($doc)/translation/texts/item[@name='cliente']/node()"/>:</td>
						<td class="datosLeft quince">
						<xsl:for-each select="/MantenimientoPedidos/MANTENIMIENTO/LISTAEMPRESAS/CLIENTE/field/dropDownList/listElem">
							<xsl:if test="ID = ../../@current">
								<xsl:value-of select="listItem"/>
							</xsl:if>
						</xsl:for-each>
						</td>
						<td>&nbsp;</td>
					</tr>
					<tr>
						<td class="labelRight cuarentacinco">&nbsp;&nbsp;<xsl:value-of select="document($doc)/translation/texts/item[@name='proveedor']/node()"/>:</td>
						<td class="datosLeft">
						<xsl:for-each select="/MantenimientoPedidos/MANTENIMIENTO/LISTAEMPRESAS/PROVEEDOR/field/dropDownList/listElem">
							<xsl:if test="ID = ../../@current">
								<xsl:value-of select="listItem"/>
							</xsl:if>
						</xsl:for-each>
						</td>
						<td>&nbsp;</td>
					</tr>-->
					<tr class="sinLinea">
						<td class="labelRight cuarentacinco">&nbsp;&nbsp;<xsl:value-of select="document($doc)/translation/texts/item[@name='numero_pedido']/node()"/>:&nbsp;</td>
						<td class="datosLeft">
							<input type="text" name="NUM_PEDIDO" value="{/MantenimientoPedidos/MANTENIMIENTO/LISTAEMPRESAS/PEDIDO/PED_NUMEROCLINICA}"/>
						</td>
						<td class="datosLeft">
							<!--<div class="boton">-->
								<a class="btnDestacado" href="javascript:Actualizar('NUMERO_PEDIDO')">
									<xsl:value-of select="document($doc)/translation/texts/item[@name='actualizar']/node()"/>
								</a>
							<!--</div>-->
						</td>
						<td>&nbsp;</td>
					</tr>
					<tr class="sinLinea">
						<td class="labelRight">&nbsp;&nbsp;<xsl:value-of select="document($doc)/translation/texts/item[@name='fecha_entrega']/node()"/>:&nbsp;</td>
						<td class="datosLeft">
							<input type="text" name="FECHA_ENTREGA" value="{/MantenimientoPedidos/MANTENIMIENTO/LISTAEMPRESAS/PEDIDO/PED_FECHAENTREGA}"/>
						</td>
						<td class="datosLeft">
							<!--<div class="boton">-->
								<a class="btnDestacado" href="javascript:Actualizar('FECHA_ENTREGA')">
									<xsl:value-of select="document($doc)/translation/texts/item[@name='actualizar']/node()"/>
								</a>
							<!--</div>-->
						</td>
						<td>&nbsp;</td>
					</tr>
					<tr><td colspan="3">&nbsp;</td></tr>
				</table>
			</xsl:if>

				<table class="buscador" border="0">
					<!--LINEAS DE PEDIDO-->
					<tr class="subTituloTabla">
						<th class="uno">&nbsp;</th>
						<th align="left" class="cinco"><xsl:value-of select="document($doc)/translation/texts/item[@name='ref_privada']/node()"/></th>
						<th align="left" class="siete"><xsl:value-of select="document($doc)/translation/texts/item[@name='ref_prov']/node()"/></th>
						<th align="left">&nbsp;<xsl:value-of select="document($doc)/translation/texts/item[@name='producto']/node()"/></th>
						<th align="left" class="dies"><xsl:value-of select="document($doc)/translation/texts/item[@name='unidad_basica']/node()"/></th>
						<th align="left" class="cinco"><xsl:value-of select="document($doc)/translation/texts/item[@name='unidad_por_lote']/node()"/></th>
						<th align="left" class="cinco"><xsl:value-of select="document($doc)/translation/texts/item[@name='cantidad']/node()"/></th>
						<th align="left" class="dies"><xsl:value-of select="document($doc)/translation/texts/item[@name='precio']/node()"/></th>
                                                <!--quitado 6-10-2015 ahora todo tipo de pedido
                                                <xsl:if test="/MantenimientoPedidos/MANTENIMIENTO/LISTAEMPRESAS/PEDIDO/MOSTRAR_PRECIO_REFERENCIA">-->
						<th align="left" class="dies"><xsl:value-of select="document($doc)/translation/texts/item[@name='precio_ref']/node()"/></th>
                                                <xsl:if test="/MantenimientoPedidos/LANG = 'spanish'">
                                                <th align="left" class="tres"><xsl:value-of select="document($doc)/translation/texts/item[@name='iva']/node()"/></th>
                                                </xsl:if>
						<th align="left" class="dies">&nbsp;</th>
                                                <xsl:if test="/MantenimientoPedidos/MANTENIMIENTO/LISTAEMPRESAS/MANTENIMIENTO_AVANZADO">
						<th align="left" class="cinco"><xsl:value-of select="document($doc)/translation/texts/item[@name='ref_alternativa']/node()"/></th>
						<th align="left" class="seis"><xsl:value-of select="document($doc)/translation/texts/item[@name='prod_alternativo']/node()"/></th>
						<th align="left" class="dos">&nbsp;</th>
						<th class="uno">&nbsp;</th>
                                                </xsl:if>
						<th class="uno">&nbsp;</th>
					</tr>

				<xsl:for-each select="/MantenimientoPedidos/MANTENIMIENTO/LISTAEMPRESAS/PEDIDO/LINEASPEDIDO/LINEAPEDIDO">
					<tr>
						<td>&nbsp;</td>
						<td class="datosLeft refPrivada"><xsl:value-of select="REFPRIVADA"/></td>
						<td class="datosLeft refProveedores"><xsl:value-of select="REFPROVEEDOR"/></td>
						<td class="datosLeft"><xsl:value-of select="NOMBRE"/></td>
						<td class="datosLeft">
							<xsl:choose>
							<xsl:when test="/MantenimientoPedidos/MANTENIMIENTO/LISTAEMPRESAS/MANTENIMIENTO_AVANZADO">
								<input type="text" class="mediano" name="UN_BASICA_{LMO_ID}" size="10" value="{UNIDADBASICA}"/>
							</xsl:when>
							<xsl:otherwise>
								<xsl:value-of select="UNIDADBASICA"/>
								<input type="hidden" name="UN_BASICA_{LMO_ID}" value="{UNIDADBASICA}"/>
							</xsl:otherwise>
							</xsl:choose>
                                                </td>
						<td class="datosLeft">
							<xsl:choose>
							<xsl:when test="/MantenimientoPedidos/MANTENIMIENTO/LISTAEMPRESAS/MANTENIMIENTO_AVANZADO">
								<input type="text" class="peq" name="UN_LOTE_{LMO_ID}" size="4" value="{UNIDADESPORLOTE}"/>
							</xsl:when>
							<xsl:otherwise>
								<xsl:value-of select="UNIDADESPORLOTE"/>
								<input type="hidden" name="UN_LOTE_{LMO_ID}" value="{UNIDADESPORLOTE}"/>
							</xsl:otherwise>
							</xsl:choose>
                                                </td>
						<td class="datosLeft">
							<input type="text" class="peq" name="CANTIDAD_{LMO_ID}" size="4" value="{CANTIDAD}"/>
						</td>
						<td class="datosLeft">
							<xsl:choose>
							<xsl:when test="/MantenimientoPedidos/MANTENIMIENTO/LISTAEMPRESAS/MANTENIMIENTO_AVANZADO">
								<input type="text" class="peq" name="PRECIO_{LMO_ID}" size="10" value="{PRECIOUNITARIO}"/>
							</xsl:when>
							<xsl:otherwise>
								<xsl:value-of select="PRECIOUNITARIO"/>
								<input type="hidden" name="PRECIO_{LMO_ID}" value="{PRECIOUNITARIO}"/>
							</xsl:otherwise>
							</xsl:choose>
                                                </td>
                                               <!-- <xsl:if test="../../MOSTRAR_PRECIO_REFERENCIA">-->
						<td class="datosLeft">
							<xsl:choose>
							<xsl:when test="/MantenimientoPedidos/MANTENIMIENTO/LISTAEMPRESAS/MANTENIMIENTO_AVANZADO">
								<input type="text" class="peq" name="PRECIOREF_{LMO_ID}" size="10" value="{PRECIOREFERENCIA}"/>
							</xsl:when>
							<xsl:otherwise>
								<xsl:value-of select="PRECIOREFERENCIA"/>
								<input type="hidden" name="PRECIOREF_{LMO_ID}" value="{PRECIOREFERENCIA}"/>
							</xsl:otherwise>
							</xsl:choose>
                                                </td>
                                                <xsl:if test="//MantenimientoPedidos/LANG = 'spanish'">
                                                <td class="datosLeft">
                                                    <xsl:value-of select="PORCENTAJEIVA"/>&nbsp;%
                                                    <input type="hidden" name="PORCENTAJEIVA_{LMO_ID}" value="{PORCENTAJEIVA}"/>
                                                </td>
                                                </xsl:if>
                                                <td>
							<!--<div class="boton">-->
								<a class="btnDestacado" href="javascript:Actualizar('CAMBIAR_LINEA','{LMO_ID}','{LPE_ID}')">
									<xsl:value-of select="document($doc)/translation/texts/item[@name='actualizar']/node()"/>
								</a>
							<!--</div>-->
						</td>
						<xsl:if test="/MantenimientoPedidos/MANTENIMIENTO/LISTAEMPRESAS/MANTENIMIENTO_AVANZADO">
						<td class="datosLeft"><xsl:value-of select="ALTERNATIVA/REFERENCIA"/></td>
						<td class="datosLeft"><xsl:value-of select="ALTERNATIVA/NOMBRE"/></td>

						<!-- ocultar = N => visible, ocultar = S =>oculto  <xsl:value-of select="ALTERNATIVA/NO_MOSTRAR"/>-->
						<td>
						<xsl:choose>
						<xsl:when test="ALTERNATIVA/NO_MOSTRAR = 'N'">
							<a href="javascript:Ocultar({LPE_ID},'S')">
								<img src="http://www.newco.dev.br/images/visible.gif" alt="Visible"/>
							</a>
						</xsl:when>
						<xsl:when test="ALTERNATIVA/NO_MOSTRAR = 'S'">
							<a href="javascript:Ocultar({LPE_ID},'N')">
								<img src="http://www.newco.dev.br/images/oculto.gif" alt="Oculto"/>
							</a>
						</xsl:when>
						<xsl:otherwise>&nbsp;</xsl:otherwise>
						</xsl:choose>
						</td>
						<td>
						<xsl:choose>
						<!-- Si NO es un pedido programado -->
						<xsl:when test="/MantenimientoPedidos/MANTENIMIENTO/LISTAEMPRESAS/PEDIDO/PED_ID">
							<a href="javascript:Actualizar('BORRAR_LINEA',{LMO_ID},{LPE_ID})">
								<img src="http://www.newco.dev.br/images/borrar.gif" alt="eliminar"/>
							</a>
						</xsl:when>
						<xsl:otherwise>&nbsp;</xsl:otherwise>
						</xsl:choose>
						</td>
</xsl:if>
						<td>&nbsp;</td>
					</tr>
				</xsl:for-each>

				<tr><td colspan="13">&nbsp;</td></tr>
				<!-- Si NO es un pedido programado -->
				<xsl:if test="/MantenimientoPedidos/MANTENIMIENTO/LISTAEMPRESAS/PEDIDO/PED_ID">
					<!--añadir una nueva linea al pedido-->
					<tr class="amarillo">
						<td class="labelRight" colspan="4">
							<strong><xsl:value-of select="document($doc)/translation/texts/item[@name='anadir_linea_pedido']/node()"/>:</strong>
							&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<xsl:value-of select="document($doc)/translation/texts/item[@name='ref']/node()"/>.
						</td>
						<td class="datosLeft"><input type="text" name="NEWLINE_REFPROV" id="NEWLINE_REFPROV" size="20" /></td>
                        <td class="datosLeft" colspan="2">
							<div class="boton" id="botonBuscarEnvio">
								<a href="javascript:DatosProducto();">
									<xsl:value-of select="document($doc)/translation/texts/item[@name='buscar']/node()"/>&nbsp;
								</a>
                                <!--<a href="javascript:Actualizar('NUEVA_LINEA');">
									<xsl:value-of select="document($doc)/translation/texts/item[@name='buscar']/node()"/>&nbsp;
								</a>-->
							</div>
						</td>
						<td class="datosLeft" colspan="9">
							&nbsp;&nbsp;<span class="rojo">(<xsl:value-of select="document($doc)/translation/texts/item[@name='productos_en_plantilla']/node()"/>)</span>
						</td>
					</tr>
                    <tr class="amarillo" id="datosProd" style="display:none;">
                    
                    </tr>
				</xsl:if>
				</table>
				<br /><br />
				<!--fin de añadir una nueva linea al pedido-->
			</div><!--fin de divLeft-->

<xsl:if test="/MantenimientoPedidos/MANTENIMIENTO/LISTAEMPRESAS/MANTENIMIENTO_AVANZADO">
        <!--AÑADIMOS PRODUCTOS MANUALES, NO EN PLANTILLA-->
    	<div class="divleft">
        	<div class="divLeft20" style="border:0px solid red;">&nbsp;</div>
            <div class="divLeft15nopa" style="border:0px solid red;">
            	<!--<div class="botonLargoVerdadNara">-->
            	<a class="btnNormal" href="javascript:VerProductosManuales();"><xsl:value-of select="document($doc)/translation/texts/item[@name='anadir_productos_manuales']/node()"/></a>
               <!-- </div>-->
            </div>
            <div class="divLeft60" style="border:0px solid red;">&nbsp;</div>
        </div>

    
        <div class="divleft" id="divProductosManuales">
        	<xsl:attribute name="style">
            	<xsl:choose>
                	<xsl:when test="/MantenimientoPedidos/MANTENIMIENTO/LISTAEMPRESAS/PEDIDO/PRODUCTOSMANUALES/PRODUCTOMANUAL">display:block;</xsl:when>
                    <xsl:otherwise>display:none;</xsl:otherwise>
                </xsl:choose>
            </xsl:attribute>
        <!--AÑADIMOS TABLA DE PRODUCTOS MANUALES, NO EN PLANTILLA-->
          <table class="buscador" id="productosManuales">
          	<!--<xsl:attribute name="style">
            	<xsl:choose>
                	<xsl:when test="/MantenimientoPedidos/MANTENIMIENTO/LISTAEMPRESAS/PEDIDO/PRODUCTOSMANUALES/PRODUCTOMANUAL">display:block;</xsl:when>
                    <xsl:otherwise>display:none;</xsl:otherwise>
                </xsl:choose>
            </xsl:attribute>-->
          <thead>
                <tr class="subTituloTabla">   
                    <!-- ref prove -->
                    <td align="left" class="quince">
                        &nbsp;<xsl:value-of select="document($doc)/translation/texts/item[@name='ref_prov']/node()"/>
                    </td> 
                    <!-- producto descripcion-->
                    <td class="textLeft cuarenta">
                        <xsl:value-of select="document($doc)/translation/texts/item[@name='productos_manuales']/node()"/>
                    </td>
                    <!-- ud base -->
                    <td class="quince">
                        &nbsp;<xsl:value-of select="document($doc)/translation/texts/item[@name='ud_basica']/node()"/>&nbsp;
                    </td>
                    <!-- cantidad -->
                    <td class="quince">
                        &nbsp;<xsl:value-of select="document($doc)/translation/texts/item[@name='cantidad']/node()"/>&nbsp;
                    </td>
                    <!-- precio ud base 
                    <td class="dies">
                        <xsl:copy-of select="document($doc)/translation/texts/item[@name='precio_final']/node()"/>
                    </td>-->
                    <!-- iva 
                    <td class="dies">
                        <xsl:value-of select="document($doc)/translation/texts/item[@name='tipo_iva']/node()"/>
                    </td>-->
                    <!-- eliminar -->
                    <td class="dies">&nbsp;</td>
                    <td>&nbsp;</td>
                 </tr>
            </thead>
            <tbody>
            	<xsl:for-each select="/MantenimientoPedidos/MANTENIMIENTO/LISTAEMPRESAS/PEDIDO/PRODUCTOSMANUALES/PRODUCTOMANUAL">
                <tr>
                	<td><xsl:value-of select="MOP_REFPROVEEDOR"/></td>
                    <td><xsl:value-of select="MOP_DESCRIPCION"/></td>
                    <td><xsl:value-of select="MOP_UNIDADBASICA"/></td>
                    <td><xsl:value-of select="substring-before(MOP_CANTIDAD,',')"/></td>
                    <td>
                    	<a class="accBorrar" href="javascript:EliminarProductosManuales('{MOP_ID}');">
                        	<img src='http://www.newco.dev.br/images/borrar.gif'/>
                        </a>
                    </td>
                    <td>&nbsp;</td>   
                </tr>                 
                </xsl:for-each>
            </tbody>
            </table><!--fin de tabla añadir prod no en plantilla-->
           </div><!--fin de divProductosManuales-->


           <div class="divLeft">
            <!--añadir nuevo producto no en plantilla-->
            <table class="infoTableNara" id="InsertarProductosManuales" border="0" style="display:none;">
                <tr>   
                    <th colspan="8" class="textLeft">&nbsp;<xsl:value-of select="document($doc)/translation/texts/item[@name='anadir_productos_manuales']/node()"/></th>
                 </tr>
            <tbody>
                    <input type="hidden" name="MOID" id="MOID" value="{/MantenimientoPedidos/MANTENIMIENTO/LISTAEMPRESAS/PEDIDO/MO_ID}"/>
                    <td class="labelRight quince">
                        <xsl:value-of select="document($doc)/translation/texts/item[@name='ref_prov']/node()"/>:&nbsp;
                        <input type="text" name="REFPROVEEDOR" id="REFPROVEEDOR" size="10" />
                    </td>
                    <td class="labelRight">
                        <xsl:value-of select="document($doc)/translation/texts/item[@name='producto']/node()"/>:&nbsp;
                        <input type="text" name="DESCRIPCION" id="DESCRIPCION" size="40"/>
                    </td>
                    <td class="labelRight quince">
                        <xsl:value-of select="document($doc)/translation/texts/item[@name='ud_basica']/node()"/>:&nbsp;
                        <input type="text" name="UNIDADBASICA" id="UNIDADBASICA" size="10"/>
                    </td>
                    <td class="labelRight quince">
                        <xsl:value-of select="document($doc)/translation/texts/item[@name='cantidad']/node()"/>:&nbsp;
                        <input type="text" name="CANTIDAD" id="CANTIDAD" size="10"/>
                    </td>
                    <!--
                    <td class="labelRight dies">
                        <xsl:value-of select="document($doc)/translation/texts/item[@name='precio']/node()"/>:&nbsp;
                        <input type="text" name="PRECIOUNITARIO" id="PRECIOUNITARIO" size="10"/>
                    </td>
                    <td class="labelRight dies">
                        <xsl:value-of select="document($doc)/translation/texts/item[@name='tipo_iva']/node()"/>:&nbsp;
                        <input type="text" name="TIPO_IVA" id="TIPO_IVA" size="5"/>
                    </td>-->
                    <td class="dies"><a href="javascript:AnadirProductosManuales();"><img src="http://www.newco.dev.br/images/botonAnadir.gif" alt="Añadir" /></a></td>
                    <td>&nbsp;</td>
            </tbody>
            </table><!--fin de añadir nuevo producto no en plantilla-->
            <BR /><BR />
        </div>

	<!-- Textarea para informar el motivo al borrar un pedido -->
	<div class="divLeft" style="margin-bottom:20px;">
		<table>
			<tr>
				<td class="cinquenta">&nbsp;</td>
				<td valign="top"><label><strong><xsl:copy-of select="document($doc)/translation/texts/item[@name='motivo_borrar_2line']/node()"/></strong></label></td>
				<td><textarea cols="50" name="MOTIVO_BORRAR" id="MOTIVO_BORRAR"></textarea></td>
				<td>&nbsp;</td>                                
                        </tr>
                </table>
	</div>
</xsl:if>

		<!-- Si NO es un pedido programado -->
		<xsl:if test="/MantenimientoPedidos/MANTENIMIENTO/LISTAEMPRESAS/PEDIDO/PED_ID">
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			<a class="btnNormal">
            <xsl:attribute name="href">javascript:VerPedido('<xsl:value-of select="/MantenimientoPedidos/MANTENIMIENTO/MO_ID"/>');</xsl:attribute>
            <xsl:value-of select="document($doc)/translation/texts/item[@name='ver_pedido']/node()"/>&nbsp;</a>
			&nbsp;
			<a class="btnNormal" href="javascript:BorrarPedido();">&nbsp;<xsl:value-of select="document($doc)/translation/texts/item[@name='borrar_pedido']/node()"/>&nbsp;</a>
			&nbsp;
            <!--si es un pedido rechazado (que no tiene lineas de pedido) no retrocedemos si no fallan los datos 9-9-15 mc-->
            <xsl:if test="/MantenimientoPedidos/MANTENIMIENTO/LISTAEMPRESAS/PEDIDO/LINEASPEDIDO/LINEAPEDIDO">
				<a class="btnNormal" href="javascript:PedidoPendienteDeRecepcion(document.forms['form1']);">&nbsp;<xsl:value-of select="document($doc)/translation/texts/item[@name='pendiente_recepcion']/node()"/>&nbsp;</a>
			&nbsp;
            </xsl:if>
			<a class="btnNormal" href="javascript:GenerarPDF();"><xsl:value-of select="document($doc)/translation/texts/item[@name='generar_pdf']/node()"/></a>
			&nbsp;
            <xsl:if test="MantenimientoPedidos/LANG = 'spanish'">
				<a class="btnNormal" href="javascript:Actualizar('ACTUALIZARIVA');"><xsl:value-of select="document($doc)/translation/texts/item[@name='actualizar_iva']/node()"/></a>
            </xsl:if>
		</xsl:if>
		</xsl:when>
		<xsl:otherwise>
        	<table class="infoTable" border="0">
			<!--LINEAS DE PEDIDO-->
			<tr>
			<th class="uno">&nbsp;</th>
			<th align="left" class="cinco"><xsl:value-of select="document($doc)/translation/texts/item[@name='ref_privada']/node()"/></th>
			<th align="left" class="cinco"><xsl:value-of select="document($doc)/translation/texts/item[@name='ref_prov']/node()"/></th>
			<th align="left">&nbsp;<xsl:value-of select="document($doc)/translation/texts/item[@name='producto']/node()"/></th>
			<th align="left" class="dies"><xsl:value-of select="document($doc)/translation/texts/item[@name='unidad_basica']/node()"/></th>
			<th align="left" class="cinco"><xsl:value-of select="document($doc)/translation/texts/item[@name='unidad_por_lote']/node()"/></th>
			<th align="left" class="cinco"><xsl:value-of select="document($doc)/translation/texts/item[@name='cantidad']/node()"/></th>
			<th align="left" class="dies"><xsl:value-of select="document($doc)/translation/texts/item[@name='precio']/node()"/></th>
			<xsl:if test="/MantenimientoPedidos/MANTENIMIENTO/LISTAEMPRESAS/PEDIDO/MOSTRAR_PRECIO_REFERENCIA">
				<th align="left" class="dies"><xsl:value-of select="document($doc)/translation/texts/item[@name='precio_ref']/node()"/></th>
			</xsl:if>
			<xsl:if test="/MantenimientoPedidos/LANG = 'spanish'">
				<th align="left" class="tres"><xsl:value-of select="document($doc)/translation/texts/item[@name='iva']/node()"/></th>
			</xsl:if>
			<th align="left" class="dies">&nbsp;</th>
			<xsl:if test="/MantenimientoPedidos/MANTENIMIENTO/LISTAEMPRESAS/MANTENIMIENTO_AVANZADO">
				<th align="left" class="dies"><xsl:value-of select="document($doc)/translation/texts/item[@name='ref_alternativa']/node()"/></th>
				<th align="left" class="dies"><xsl:value-of select="document($doc)/translation/texts/item[@name='prod_alternativo']/node()"/></th>
				<th align="left" class="cinco">&nbsp;</th>
				<th class="uno">&nbsp;</th>
			</xsl:if>
			<th class="uno">&nbsp;</th>
			</tr>

				<xsl:for-each select="MantenimientoPedidos/MANTENIMIENTO/LISTAEMPRESAS/PEDIDO/LINEASPEDIDO/LINEAPEDIDO">
					<tr>
						<td>&nbsp;</td>
						<td class="datosLeft refPrivada"><xsl:value-of select="REFPRIVADA"/></td>
						<td class="datosLeft refProveedores"><xsl:value-of select="REFPROVEEDOR"/></td>
						<td class="datosLeft"><xsl:value-of select="NOMBRE"/></td>
						<td class="datosLeft">
							<xsl:choose>
							<xsl:when test="/MantenimientoPedidos/MANTENIMIENTO/LISTAEMPRESAS/MANTENIMIENTO_AVANZADO">
								<input type="text" name="UN_BASICA_{LMO_ID}" size="10" value="{UNIDADBASICA}"/>
							</xsl:when>
							<xsl:otherwise>
								<xsl:value-of select="UNIDADBASICA"/>
								<input type="hidden" name="UN_BASICA_{LMO_ID}" value="{UNIDADBASICA}"/>
							</xsl:otherwise>
							</xsl:choose>
                                                </td>
						<td class="datosLeft">
							<xsl:choose>
							<xsl:when test="/MantenimientoPedidos/MANTENIMIENTO/LISTAEMPRESAS/MANTENIMIENTO_AVANZADO">
								<input type="text" name="UN_LOTE_{LMO_ID}" size="4" value="{UNIDADESPORLOTE}"/>
							</xsl:when>
							<xsl:otherwise>
								<xsl:value-of select="UNIDADESPORLOTE"/>
								<input type="hidden" name="UN_LOTE_{LMO_ID}" value="{UNIDADESPORLOTE}"/>
							</xsl:otherwise>
							</xsl:choose>
                                                </td>
						<td class="datosLeft"><input type="text" name="CANTIDAD_{LMO_ID}" size="4" value="{CANTIDAD}"/></td>
						<td class="datosLeft">
							<xsl:choose>
							<xsl:when test="/MantenimientoPedidos/MANTENIMIENTO/LISTAEMPRESAS/MANTENIMIENTO_AVANZADO">
								<input type="text" name="PRECIO_{LMO_ID}" size="10" value="{PRECIOUNITARIO}"/>
							</xsl:when>
							<xsl:otherwise>
								<xsl:value-of select="PRECIOUNITARIO"/>
								<input type="hidden" name="PRECIO_{LMO_ID}" value="{PRECIOUNITARIO}"/>
							</xsl:otherwise>
							</xsl:choose>
                                                </td>
                                                <xsl:if test="../../MOSTRAR_PRECIO_REFERENCIA">
						<td class="datosLeft">
							<xsl:choose>
							<xsl:when test="/MantenimientoPedidos/MANTENIMIENTO/LISTAEMPRESAS/MANTENIMIENTO_AVANZADO">
								<input type="text" name="PRECIOREF_{LMO_ID}" size="10" value="{PRECIOREFERENCIA}"/>
							</xsl:when>
							<xsl:otherwise>
								<xsl:value-of select="PRECIOREFERENCIA"/>
								<input type="hidden" name="PRECIOREF_{LMO_ID}" value="{PRECIOREFERENCIA}"/>
							</xsl:otherwise>
							</xsl:choose>
                                                </td>
                                                </xsl:if>
                                                <xsl:if test="//MantenimientoPedidos/LANG = 'spanish'">
                                                <td class="datosLeft">
                                                    <xsl:value-of select="PORCENTAJEIVA"/>&nbsp;%
                                                    <input type="hidden" name="PORCENTAJEIVA_{LMO_ID}" value="{PORCENTAJEIVA}"/>
                                                </td>
                                                </xsl:if>
                                                <td>
							<div class="boton">
								<a href="javascript:Actualizar('CAMBIAR_LINEA','{LMO_ID}','{LPE_ID}')">
									<xsl:value-of select="document($doc)/translation/texts/item[@name='actualizar']/node()"/>
								</a>
							</div>
						</td>
						<xsl:if test="/MantenimientoPedidos/MANTENIMIENTO/LISTAEMPRESAS/MANTENIMIENTO_AVANZADO">
							<td class="datosLeft"><xsl:value-of select="ALTERNATIVA/REFERENCIA"/></td>
							<td class="datosLeft"><xsl:value-of select="ALTERNATIVA/NOMBRE"/></td>

							<!-- ocultar = N => visible, ocultar = S =>oculto  <xsl:value-of select="ALTERNATIVA/NO_MOSTRAR"/>-->
							<td>
								<xsl:choose>
								<xsl:when test="ALTERNATIVA/NO_MOSTRAR = 'N'">
									<a href="javascript:Ocultar({LPE_ID},'S')">
										<img src="http://www.newco.dev.br/images/visible.gif" alt="Visible"/>
									</a>
								</xsl:when>
								<xsl:when test="ALTERNATIVA/NO_MOSTRAR = 'S'">
									<a href="javascript:Ocultar({LPE_ID},'N')">
										<img src="http://www.newco.dev.br/images/oculto.gif" alt="Oculto"/>
									</a>
								</xsl:when>
								<xsl:otherwise>&nbsp;</xsl:otherwise>
								</xsl:choose>
							</td>
							<td>
								<xsl:choose>
								<!-- Si NO es un pedido programado -->
								<xsl:when test="/MantenimientoPedidos/MANTENIMIENTO/LISTAEMPRESAS/PEDIDO/PED_ID">
									<a href="javascript:Actualizar('BORRAR_LINEA',{LMO_ID},{LPE_ID})">
										<img src="http://www.newco.dev.br/images/borrar.gif" alt="eliminar"/>
									</a>
								</xsl:when>
								<xsl:otherwise>&nbsp;</xsl:otherwise>
								</xsl:choose>
							</td>
						</xsl:if>
						<td>&nbsp;</td>
					</tr>
				</xsl:for-each>

				
				</table>
<!--
			<div class="divLeft40">&nbsp;</div>
				<div class="divLeft20 boton">
					<a href="javascript:ComprobarPedido();">&nbsp;<xsl:value-of select="document($doc)/translation/texts/item[@name='comprobar_pedido']/node()"/>&nbsp;</a>
				</div>
-->
		</xsl:otherwise>
		</xsl:choose>
		</div><!--fin de divleft-->
        <p>&nbsp;</p>
	</xsl:otherwise>
	</xsl:choose>
	</form>

	<!--mensaje de error-->
	<form name="MensajeJS">
		<input type="hidden" name="OBLI_FECHA_ENTREGA" value="{document($doc)/translation/texts/item[@name='obligatorio_fecha_entrega']/node()}"/>
		<input type="hidden" name="OBLI_NUM_PEDIDO" value="{document($doc)/translation/texts/item[@name='obligatorio_num_pedido']/node()}"/>
		<input type="hidden" name="OBLI_UD_BASE" value="{document($doc)/translation/texts/item[@name='obligatorio_ud_basica']/node()}"/>
		<input type="hidden" name="OBLI_UD_LOTE" value="{document($doc)/translation/texts/item[@name='obligatorio_ud_lote']/node()}"/>
		<input type="hidden" name="OBLI_CANTIDAD" value="{document($doc)/translation/texts/item[@name='obligatorio_cantidad']/node()}"/>
		<input type="hidden" name="OBLI_REF_PROVE" value="{document($doc)/translation/texts/item[@name='obligatorio_ref_proveedor']/node()}"/>
		<input type="hidden" name="NOT_A_NUMBER" value="{document($doc)/translation/texts/item[@name='not_a_number']/node()}"/>
		<input type="hidden" name="PRODUCTO_EXISTE_PEDIDO" value="{document($doc)/translation/texts/item[@name='producto_existe_pedido']/node()}"/>
		<input type="hidden" name="SEGURO_ELIMINAR_LINEA_PEDIDO" value="{document($doc)/translation/texts/item[@name='seguro_eliminar_linea_pedido']/node()}"/>
		<input type="hidden" name="CLIENTE_OBLI" value="{document($doc)/translation/texts/item[@name='seleccionar_cliente_obligatorio']/node()}"/>
		<input type="hidden" name="PROVEEDOR_OBLI" value="{document($doc)/translation/texts/item[@name='seleccionar_proveedor_obligatorio']/node()}"/>
		<input type="hidden" name="MO_ID_OBLI" value="{document($doc)/translation/texts/item[@name='mo_id_obligatorio']/node()}"/>
		<input type="hidden" name="CANTIDAD_INCORRECTA" value="{document($doc)/translation/texts/item[@name='cantidad_incorrecta']/node()}"/>
		<input type="hidden" name="ENVIAR" value="{document($doc)/translation/texts/item[@name='enviar']/node()}"/>
		<input type="hidden" name="BUSCAR" value="{document($doc)/translation/texts/item[@name='buscar']/node()}"/>
		<input type="hidden" name="PRECIO_REF_INFERIOR" value="{document($doc)/translation/texts/item[@name='precio_ref_inferior']/node()}"/>
        
        <!--mensajeJS prod manuales-->
        <input type="hidden" name="ERROR_INSERTAR_DATOS" value="{document($doc)/translation/texts/item[@name='error_insertar_datos']/node()}"/>
        <input type="hidden" name="ERROR_ELIMINAR_DATOS" value="{document($doc)/translation/texts/item[@name='error_eliminar_datos']/node()}"/>
        <input type="hidden" name="TODOS_CAMPOS_OBLI" value="{document($doc)/translation/texts/item[@name='todos_campos_obli']/node()}"/>
        <input type="hidden" name="PDF_ENVIADO_CON_EXITO" value="{document($doc)/translation/texts/item[@name='pdf_enviado_con_exito']/node()}"/>
	</form>
</body>
</html>
</xsl:template>
</xsl:stylesheet>
